
<!doctype html>
<html lang="en" class="dark"> <!-- default to dark, toggled via JS -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Net Net V2 Vision</title>
  <link rel="icon" type="image/svg+xml" href="https://www.myfonts.com/static-assets/images/public/logo/favicon.76b1a3.svg" />
  <link rel="icon" href="https://hellonetnet.com/wp-content/uploads/2024/12/symbol-standard.svg" type="image/svg+xml">
  <link rel="shortcut icon" href="https://hellonetnet.com/wp-content/uploads/2024/12/symbol-standard.svg">

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: { netnet: { purple: '#711FFF' } },
          screens: {
            'md': '768px',
            'lg': '1024px',
            'xl': '1280px',
          }
        }
      }
    }
  </script>

  <style>
    /* ===== Localized faded grid (behind card only) ===== */
    .auth-grid { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; z-index:0; }
    .grid-box{
      width:clamp(640px,60vw,960px);
      height:clamp(420px,48vh,560px);
      --grid: rgba(255,255,255,0.08);
      background:
        repeating-linear-gradient(0deg, var(--grid) 0 1px, transparent 1px 24px),
        repeating-linear-gradient(90deg, var(--grid) 0 1px, transparent 1px 24px);
      -webkit-mask: radial-gradient(700px 520px at 50% 40%, rgba(0,0,0,.95) 60%, rgba(0,0,0,.5) 78%, transparent 100%);
              mask: radial-gradient(700px 520px at 50% 40%, rgba(0,0,0,.95) 60%, rgba(0,0,0,.5) 78%, transparent 100%);
    }
    html:not(.dark) .grid-box{ --grid: rgba(0,0,0,0.08); }

    /* ===== Segmented switcher (final) ===== */
    .switch-shell{
      display:flex; align-items:center;
      min-width:480px; height:48px; padding:4px;
      border-radius:9999px;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.18);
      backdrop-filter:blur(6px);
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.10), 0 6px 18px rgba(0,0,0,0.25);
    }
    .switch-tab{
      flex:1 1 0; min-width:0;              /* equal widths */
      display:inline-flex; align-items:center; justify-content:center;
      height:40px; padding:0 24px; border-radius:9999px;
      font-weight:700; font-size:15px; line-height:1;
      color:rgba(255,255,255,0.92);
      transition:background-color .18s ease, color .18s ease, box-shadow .18s ease, transform .18s ease;
    }
    .switch-tab:hover{ transform:translateY(-0.5px); }
    .switch-tab[aria-selected="true"]{
      background:rgba(255,255,255,0.14);
      color:#fff;
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.35), 0 1px 0 rgba(0,0,0,0.25);
    }
    /* Focus ring for keyboard users */
    .switch-tab:focus-visible{
      outline:2px solid #711FFF; outline-offset:2px;
      box-shadow:0 0 0 2px rgba(113,31,255,0.25);
    }
    /* Light mode overrides */
    html:not(.dark) .switch-shell{
      background:rgba(16,16,16,0.05);
      border-color:rgba(0,0,0,0.12);
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.65), 0 6px 16px rgba(0,0,0,0.08);
    }
    html:not(.dark) .switch-tab{ color:rgba(17,17,17,0.85); }
    html:not(.dark) .switch-tab[aria-selected="true"]{
      background:rgba(0,0,0,0.09); color:#111;
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.9), 0 1px 0 rgba(0,0,0,0.06);
    }

    /* ===== Card ===== */
    .auth-card { max-width:480px; width:100%; border-radius:12px; }

    /* ===== Input vertical padding tweak ===== */
    .auth-card input[type="email"],
    .auth-card input[type="password"]{
      padding-top: 0.625rem;  /* 10px — slightly more breathing room */
      padding-bottom: 0.625rem;
      line-height: 1.4;
    }

    /* Error overlay (so we never get a silent blank screen) */
    #debug-overlay { position:fixed; inset:0; z-index:99999; background:#111; color:#f66; padding:16px; overflow:auto; font:14px/1.4 ui-monospace,Menlo,monospace; }

    /* === Auth: 4-digit code boxes === */
    .code-grid { display:grid; grid-template-columns: repeat(4, 64px); gap: 16px; justify-content:center; }
    .code-box {
      height:64px; border-radius:12px; text-align:center; font-size:28px; font-weight:700;
      border:1px solid rgba(255,255,255,0.12); background:rgba(255,255,255,0.04); color:#fff;
    }
    html:not(.dark) .code-box {
      border-color: rgba(0,0,0,0.12); background: rgba(0,0,0,0.04); color:#111;
    }
    .code-box:focus { outline:2px solid #711FFF; outline-offset:2px; }

    /* ===== Center secondary auth cards (Forgot / Verify) ===== */
    .auth-center-wrap {
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .auth-center-wrap .auth-card {
      margin-left:auto;
      margin-right:auto;
    }

    /* Make auth Log in / Sign up switcher fluid on small screens only */
    @media (max-width: 640px) {
      .auth-switcher-inner {
        width: min(95vw, 420px);
        min-width: 0 !important;
      }
    }
  </style>
  <style id="auth-input-pad-tweak">
    /* Force a bit more vertical padding inside auth inputs */
    .auth-card :is(input[type="email"], input[type="password"]) {
      padding-top: 0.70rem !important;   /* ~11.2px */
      padding-bottom: 0.70rem !important;
      line-height: 1.35 !important;      /* keeps text optically centered */
    }
  </style>
  <style id="auth-input-horizontal-padding">
    /* --- Auth input horizontal inset fix --- */
    .auth-card input:not(.code-box)[type="text"],
    .auth-card input:not(.code-box)[type="email"],
    .auth-card input:not(.code-box)[type="password"]{
      padding-left: 0.875rem !important;  /* ≈ 14 px */
      padding-right: 0.875rem !important; /* keeps symmetry */
    }
  </style>
  <style id="auth-footer-and-eye">
    /* Fixed, subtle bottom tagline on auth screens */
    .auth-bottom-note{
      position:fixed; left:0; right:0; bottom:14px; z-index:20;
      text-align:center; font-size:12px; line-height:1.4;
      color: rgba(255,255,255,0.55);
    }
    html:not(.dark) .auth-bottom-note{ color: rgba(17,17,17,0.55); }
    .auth-bottom-note a{ color:#6c4cff; text-decoration:underline; }
  </style>
  <style id="auth-eye-center-fix">
    /* The wrapper that *directly* wraps the input */
    .pwd-wrap { position: relative; }

    /* Absolutely position the eye button against the input’s box, vertically centered */
    .pwd-wrap .pwd-eye {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 1.25rem;   /* ~20px hit area; does not affect input height */
      width: 1.25rem;
      pointer-events: auto;
      opacity: .85;
    }
    .pwd-wrap .pwd-eye:hover { opacity: 1; }
    .pwd-wrap .pwd-eye svg { width: 18px; height: 18px; display: block; }
  </style>
  <style id="app-shell-styles">
    /* Default / Mobile First: Flex column */
    #app-shell {
      display: flex;
      flex-direction: column;
      height: 100svh;
      overflow: hidden;
      --sidebar-width: 64px;
      --top-bar-height: 40px;
    }

    /* Main Content Area */
    #app-main {
      flex: 1;
      overflow-y: auto;
      /* Mobile padding to account for fixed header/footer */
      padding-top: 56px; 
      padding-bottom: 80px; 
    }

    /* Desktop Overrides (min-width: 768px) */
    @media (min-width: 768px) {
      #app-shell {
        display: grid;
        grid-template-rows: auto 1fr;
        grid-template-columns: auto 1fr;
        grid-template-areas:
          "header header"
          "sidebar main";
        --top-bar-height: 56px; /* Increased for tabs */
      }
      #app-top-bar { grid-area: header; height: var(--top-bar-height); z-index: 30; }
      #app-sidebar { grid-area: sidebar; width: var(--sidebar-width); z-index: 20; }
      
      /* Reset mobile padding on desktop */
      #app-main { 
        grid-area: main; 
        overflow-y: auto; 
        padding-top: 0 !important; 
        padding-bottom: 0 !important;
      }
    }

    /* Desktop Large Overrides (min-width: 1024px) */
    @media (min-width: 1024px) {
      #app-shell { --sidebar-width: 240px; }
      #app-sidebar a { justify-content: flex-start !important; padding-left: 1.5rem !important; width: auto !important; }
      #app-sidebar a img { margin-right: 12px; }
      /* Disable flyout on large screens, make label static */
      #app-sidebar a .flyout-label {
        position: static; transform: none; opacity: 1; pointer-events: auto;
        background: transparent !important; color: inherit !important;
        padding: 0; margin: 0;
      }
      /* Also apply to button elements in sidebar like Workspace Switcher */
      #app-sidebar button { justify-content: flex-start !important; padding-left: 1.5rem !important; width: auto !important; }
      #app-sidebar button img { margin-right: 12px; }
      #app-sidebar button .flyout-label {
        position: static; transform: none; opacity: 1; pointer-events: auto;
        background: transparent !important; color: inherit !important;
        padding: 0; margin: 0;
      }
    }

    /* Slim sidebar fly-out labels (Desktop < 1024px) */
    @media (min-width: 768px) and (max-width: 1023px) {
      #app-sidebar a .flyout-label, #app-sidebar button .flyout-label {
        position: absolute;
        left: calc(var(--sidebar-width) + 8px);
        padding: 6px 12px;
        border-radius: 6px;
        font-weight: 500;
        white-space: nowrap;
        pointer-events: none;
        opacity: 0;
        transform: translateX(-8px);
        transition: opacity 150ms ease, transform 150ms ease;
        z-index: 50;
      }
      #app-sidebar a:hover .flyout-label, #app-sidebar a:focus .flyout-label,
      #app-sidebar button:hover .flyout-label, #app-sidebar button:focus .flyout-label {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* Sidebar Light Mode Overrides for dark text */
    html:not(.dark) #app-sidebar a, 
    html:not(.dark) #app-sidebar button {
      color: #334155; /* slate-700 */
    }
    html:not(.dark) #app-sidebar a:hover, 
    html:not(.dark) #app-sidebar button:hover {
      color: #0f172a; /* slate-900 */
      background-color: #e2e8f0;
    }
    html:not(.dark) #app-sidebar .flyout-label {
      color: #1f2937;
    }
    html:not(.dark) #app-sidebar nav div a {
      color: #475569;
    }
    html:not(.dark) #app-sidebar nav div a:hover {
      color: #0f172a;
    }

    /* Top bar fly-out labels (Desktop) */
    #app-top-bar button .flyout-label {
      position: absolute;
      top: calc(100% + 8px);
      left: 50%;
      padding: 6px 12px;
      border-radius: 6px;
      font-weight: 500;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transform: translateX(-50%) translateY(-8px);
      transition: opacity 150ms ease, transform 150ms ease;
      z-index: 50; /* ensure it's above other elements */
    }
    #app-top-bar button:hover .flyout-label,
    #app-top-bar button:focus-within .flyout-label {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* Right context drawer - Responsive Behavior */
    #app-drawer-backdrop {
      position: fixed; inset: 0; z-index: 40;
      background: rgba(0,0,0,0.5);
      opacity: 1;
      transition: opacity 250ms ease-in-out;
    }
    #app-drawer {
      position: fixed; top: 0; bottom: 0; right: 0; z-index: 50;
      width: 90%; max-width: 400px;
      transform: translateX(0);
      transition: transform 250ms ease-in-out;
    }
    #app-shell.drawer-closed #app-drawer-backdrop {
      opacity: 0;
      pointer-events: none;
    }
    #app-shell.drawer-closed #app-drawer {
      transform: translateX(100%);
    }

    /* Mobile Drawer Override: Slide up from bottom */
    @media (max-width: 767px) {
      #app-drawer {
        top: auto; bottom: 0; left: 0; right: 0;
        width: 100%; max-width: 100%;
        height: 85vh; /* Panel height */
        border-radius: 16px 16px 0 0;
        transform: translateY(0);
      }
      #app-shell.drawer-closed #app-drawer {
        transform: translateY(100%);
      }
    }
    
    /* Modal Styles */
    #modal-backdrop {
      position: fixed; inset: 0; z-index: 100;
      background: rgba(0,0,0,0.5);
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: opacity 0.2s;
    }
    #modal-backdrop.open { opacity: 1; pointer-events: auto; }
    #modal-panel {
      transform: scale(0.95); transition: transform 0.2s;
    }
    #modal-backdrop.open #modal-panel { transform: scale(1); }
    
    /* Toast Styles */
    #toast-container {
      position: fixed; bottom: 20px; right: 20px; z-index: 200;
      display: flex; flex-direction: column; gap: 10px;
      pointer-events: none;
    }
    .toast-msg {
      pointer-events: auto;
      background: #1F2937; color: white;
      padding: 12px 16px; border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      font-size: 14px; font-weight: 500;
      display: flex; items-align: center; gap: 8px;
      animation: slideIn 0.3s ease forwards;
    }
    html:not(.dark) .toast-msg { background: #fff; color: #111; border: 1px solid #e5e7eb; }
    @keyframes slideIn {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes fadeOut {
      to { opacity: 0; transform: translateY(10px); }
    }
    
    /* Tooltip hint */
    [data-tooltip] { position: relative; cursor: help; }
    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute; bottom: 100%; left: 50%;
      transform: translateX(-50%) translateY(-8px);
      background: #111; color: #fff;
      padding: 6px 10px; border-radius: 4px;
      font-size: 12px; white-space: nowrap;
      z-index: 60; pointer-events: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    html:not(.dark) [data-tooltip]:hover::after { background: #333; }

    /* Fix for Performance icon in dark mode using filter on light icon */
    html.dark #app-sidebar img[data-icon="performance"] {
      filter: brightness(0) invert(1);
    }
    
    /* ===== Mobile Elements (Hidden on Desktop) ===== */
    .mobile-header {
        position: fixed; top: 0; left: 0; right: 0;
        height: 56px; z-index: 30;
        display: flex; align-items: center; justify-content: center;
        transition: transform 0.3s ease-in-out;
    }
    .mobile-bottom-nav {
        position: fixed; bottom: 0; left: 0; right: 0;
        height: 64px; z-index: 40;
        padding-bottom: env(safe-area-inset-bottom);
        background-color: #711FFF;
        display: flex; align-items: center; justify-content: space-evenly;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    }
    .mobile-menu-overlay {
        position: fixed; inset: 0; z-index: 50;
        transform: translateY(100%);
        transition: transform 0.3s ease-in-out;
        overflow-y: auto;
        display: flex; flex-direction: column;
    }
    .mobile-menu-overlay.open { transform: translateY(0); }

    /* === Desktop workspace tabs === */
    #workspaceTabs {
      /* Adjusted gap: ml-10 is ~2.5rem */
      margin-left: 2.5rem;
      /* Hide scrollbars */
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    /* Hide scrollbars on the tab strip */
    #workspaceTabs::-webkit-scrollbar { display: none; }

    /* Base tab layout - 3 column flex */
    .workspace-tab {
      position: relative;
      display: flex;
      align-items: center;
      max-width: 200px;
      flex-shrink: 0;
      
      /* Layout: equal padding left/right */
      padding: 0.35rem 0.8rem;
      
      border-radius: 0.5rem 0.5rem 0 0;
      border: 1px solid rgba(255,255,255,0.12);
      background-color: rgba(255,255,255,0.12);
      color: rgba(255,255,255,0.75);
      font-size: 0.85rem;
      font-weight: 600;
      white-space: nowrap;
      cursor: pointer;
      transition: background-color 0.15s ease, border-color 0.15s ease, color 0.15s ease;
    }
    
    /* Left spacer to balance close button - EXCLUDE new tab */
    .workspace-tab:not(.workspace-tab--new)::before {
        content: "";
        flex: 0 0 20px;
        margin-right: 0.25rem;
    }
    
    .workspace-tab:hover {
      background-color: rgba(255,255,255,0.20);
      border-color: rgba(255,255,255,0.20);
    }
    
    .workspace-tab--active {
      border-color: rgba(255,255,255,0.32);
      background-color: rgba(255,255,255,0.32);
      color: #ffffff;
    }
    
    .workspace-tab__label {
      flex: 1 1 auto;
      text-align: center;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      padding: 0 0.4rem;
    }
    
    .workspace-tab__close {
      flex: 0 0 20px;
      height: 20px;
      margin-left: 0.25rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 9999px;
      font-size: 0.7rem;
      line-height: 1;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.15s ease, background-color 0.15s ease;
    }
    
    .workspace-tab:hover .workspace-tab__close {
      opacity: 1;
      pointer-events: auto;
    }
    
    .workspace-tab__close:hover {
      background-color: rgba(0,0,0,0.08);
    }
    
    .workspace-tab--new {
      justify-content: center;
      border-style: dashed;
      border-color: rgba(255,255,255,0.35);
      background-color: transparent;
      color: rgba(255,255,255,0.9);
      padding-left: 0.75rem; 
      padding-right: 0.75rem;
    }
    .workspace-tab--new:hover {
      background-color: rgba(255,255,255,0.18);
      border-color: rgba(255,255,255,0.35);
    }

    /* ===== Workspace Switcher Fixed Menu ===== */
    #workspaceSwitcherMenu {
      position: fixed;
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 12px;
      padding-left: 12px; /* offset from trigger */
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease, transform 0.2s ease;
      transform: translateX(-10px);
    }
    #workspaceSwitcherMenu.open {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(0);
    }
    .workspace-dial-btn {
      background: #fff;
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 9999px;
      width: 64px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
    }
    .workspace-dial-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    }
    .workspace-dial-btn img {
      width: 40px; /* Approx 2x of sidebar's 24px icons */
      height: 40px; 
      object-fit: contain;
    }
  </style>
  <style id="me-empty-state-styles">
    /* === Me Empty State (Untitled-style) === */
    .me-card { box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
    .me-featured-icon { box-shadow: inset 0 1px 2px rgba(0,0,0,0.15), 0 8px 24px rgba(0,0,0,0.12); }

    .me-rings {
      --ring-color-dark: rgba(255,255,255,0.08);
      --ring-color-light: rgba(0,0,0,0.08);
      background:
        radial-gradient(closest-side, transparent 35%, rgba(0,0,0,0.04) 36%, transparent 37%) center/100% 100% no-repeat,
        repeating-radial-gradient(circle at center,
          var(--rings-color) 0 1px, transparent 1px 28px);
      border-radius: 24px;
      filter: none;
    }
    html.dark .me-rings { --rings-color: var(--ring-color-dark); }
    html:not(.dark) .me-rings { --rings-color: var(--ring-color-light); }
  </style>
  <style id="reports-page-styles">
    .meter-bar {
      height: 8px;
      border-radius: 9999px;
      overflow: hidden;
    }
    .meter-bar-inner {
      height: 100%;
      border-radius: 9999px;
      transition: width 0.3s ease-in-out;
    }
    /* Filter Chips */
    .filter-chip {
      cursor: pointer;
      transition: all 0.2s;
    }
    .filter-chip.active {
      ring-width: 2px;
      --tw-ring-color: #711FFF;
      border-color: #711FFF;
    }
    /* Table transitions */
    .company-row-chevron {
        transition: transform 0.2s ease;
    }
    .company-row-chevron.expanded {
        transform: rotate(180deg);
    }
  </style>
<link rel="stylesheet" href="/index.css">
<script type="importmap">
{
  "imports": {
    "path": "https://aistudiocdn.com/path@^0.12.7",
    "vite": "https://aistudiocdn.com/vite@^7.2.4"
  }
}
</script>
</head>
<body class="antialiased">

  <!-- MOUNT ROOT (do not remove/rename) -->
  <div id="app" data-root></div>
  
  <!-- Generic Modal Mount -->
  <div id="modal-backdrop">
    <div id="modal-panel" class="w-full max-w-md bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 mx-4 border border-gray-200 dark:border-gray-700">
      <div id="modal-content"></div>
    </div>
  </div>
  
  <!-- Toast Mount -->
  <div id="toast-container"></div>
  
  <!-- Mobile Workspace Bottom Sheet -->
  <div id="mobileWorkspaceSheet"
       class="fixed inset-0 z-50 flex items-end justify-center bg-black/40 opacity-0 pointer-events-none transition-opacity duration-200 lg:hidden">
    <div id="mobileWorkspacePanel"
         class="w-full max-w-md rounded-t-2xl bg-slate-900 text-white shadow-2xl
                pb-6 pt-3 px-4 transform translate-y-full transition-transform duration-200">
      <div class="mx-auto mb-3 h-1 w-12 rounded-full bg-slate-600"></div>
      <div class="text-center mb-4">
        <p class="text-sm font-medium text-slate-100">Switch workspace</p>
      </div>
      <div class="flex items-center justify-around pb-2">
        <!-- Net Net -->
        <button type="button" class="mobile-workspace-option flex flex-col items-center gap-1 group" data-workspace-id="netnet">
          <span class="inline-flex items-center justify-center rounded-full bg-white shadow-md transition-transform group-active:scale-95"
                style="width:56px;height:56px;">
            <img src="https://hellonetnet.com/wp-content/uploads/2024/06/Net-Net-Symbol.svg"
                 alt="Net Net" class="h-8 w-8"/>
          </span>
          <span class="mt-1 block text-[11px] text-slate-200">Net Net</span>
        </button>
        <!-- Fathom -->
        <button type="button" class="mobile-workspace-option flex flex-col items-center gap-1 group" data-workspace-id="fathom">
          <span class="inline-flex items-center justify-center rounded-full bg-white shadow-md transition-transform group-active:scale-95"
                style="width:56px;height:56px;">
            <img src="https://hellonetnet.com/wp-content/uploads/2025/11/Fathom-Symbol-Blue-square.svg"
                 alt="Fathom" class="h-8 w-8"/>
          </span>
          <span class="mt-1 block text-[11px] text-slate-200">Fathom</span>
        </button>
        <!-- Right Here -->
        <button type="button" class="mobile-workspace-option flex flex-col items-center gap-1 group" data-workspace-id="rhi">
          <span class="inline-flex items-center justify-center rounded-full bg-white shadow-md transition-transform group-active:scale-95"
                style="width:56px;height:56px;">
            <img src="https://hellonetnet.com/wp-content/uploads/2025/11/Favicon-Red.svg"
                 alt="Right Here" class="h-8 w-8"/>
          </span>
          <span class="mt-1 block text-[11px] text-slate-200">Right Here</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    /* ========= Hard-stop error overlay ========= */
    window.addEventListener('error', e => {
      if (e.target && (e.target.tagName === 'IMG' || e.target.tagName === 'SCRIPT' || e.target.tagName === 'LINK')) {
        console.warn('Resource load failed:', e.target.src || e.target.href);
        if (e.target.tagName === 'IMG') { e.target.style.display = 'none'; }
        return; 
      }
      const pre = document.createElement('pre');
      pre.id = 'debug-overlay';
      let msg = (e?.message || '');
      if (!msg && e.target) msg = 'Error loading: ' + (e.target.src || e.target.tagName);
      if (!msg) msg = JSON.stringify(e);
      pre.textContent = 'UNCAUGHT ERROR\\n' + msg + '\\n' + (e?.filename||'') + ':' + (e?.lineno||'') + ':' + (e?.colno||'');
      document.body.appendChild(pre);
    }, true);

    const LOGIN_SUCCESS_ROUTE    = '#/app/me/tasks';
    const REGISTER_SUCCESS_ROUTE = '#/auth/verify-code';
    const RESET_SUCCESS_ROUTE    = '#/auth/success';

    /* ========= Theme helpers ========= */
    const THEME_KEY = 'theme';
    function getTheme(){
      const t = localStorage.getItem(THEME_KEY);
      if (t==='dark'||t==='light') return t;
      return matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    function setTheme(t){
      document.documentElement.classList.toggle('dark', t==='dark');
      localStorage.setItem(THEME_KEY, t);
    }

    /* ========= Workspace Switcher Logic ========= */
    const WORKSPACES = [
      { id: 'netnet', name: 'Net Net', icon: 'https://hellonetnet.com/wp-content/uploads/2024/06/Net-Net-Symbol.svg' },
      { id: 'fathom', name: 'Fathom', icon: 'https://hellonetnet.com/wp-content/uploads/2025/11/Fathom-Symbol-Blue-square.svg' },
      { id: 'rhi', name: 'Right Here Interactive', icon: 'https://hellonetnet.com/wp-content/uploads/2025/11/Favicon-Red.svg' }
    ];
    const WORKSPACE_KEY = 'activeWorkspace';
    function getActiveWorkspace() {
      const saved = localStorage.getItem(WORKSPACE_KEY);
      const found = WORKSPACES.find(w => w.id === saved);
      return found || WORKSPACES[0];
    }
    function setActiveWorkspace(id) { localStorage.setItem(WORKSPACE_KEY, id); }
    const getMobileActiveWorkspace = getActiveWorkspace;
    const setMobileActiveWorkspace = setActiveWorkspace;

    function initWorkspaceSwitcher() {
      let menu = document.getElementById('workspaceSwitcherMenu');
      if (!menu) {
          menu = document.createElement('div');
          menu.id = 'workspaceSwitcherMenu';
          document.body.appendChild(menu);
      }
      menu.innerHTML = '';
      WORKSPACES.forEach(ws => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'workspace-dial-btn';
        btn.innerHTML = `<img src="${ws.icon}" alt="${ws.name}">`;
        btn.title = ws.name;
        btn.onclick = (e) => {
            e.stopPropagation();
            setActiveWorkspace(ws.id);
            const triggerIcon = document.getElementById('workspaceSwitcherIcon');
            if (triggerIcon) triggerIcon.src = ws.icon;
            menu.classList.remove('open');
        };
        menu.appendChild(btn);
      });
      const triggerBtn = document.getElementById('workspaceSwitcherButton');
      if (triggerBtn) {
          const active = getActiveWorkspace();
          const triggerIcon = document.getElementById('workspaceSwitcherIcon');
          if (triggerIcon) triggerIcon.src = active.icon;
          triggerBtn.onclick = (e) => {
             e.stopPropagation();
             const isOpen = menu.classList.contains('open');
             if (isOpen) {
                 menu.classList.remove('open');
             } else {
                 const rect = triggerBtn.getBoundingClientRect();
                 menu.style.left = (rect.right + 8) + 'px'; 
                 const mid = rect.top + (rect.height / 2);
                 menu.style.top = (mid - 32) + 'px'; 
                 menu.classList.add('open');
             }
          };
      }
      const closeHandler = (e) => {
          if (menu.classList.contains('open') && !menu.contains(e.target) && e.target !== triggerBtn && !triggerBtn.contains(e.target)) {
              menu.classList.remove('open');
          }
      };
      document.addEventListener('click', closeHandler);
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') menu.classList.remove('open'); });
    }

    function initMobileWorkspaceSwitcher(){
      const trigger = document.getElementById('mobileWorkspaceMenuButton');
      const icon = document.getElementById('mobileWorkspaceMenuIcon');
      const sheet = document.getElementById('mobileWorkspaceSheet');
      const panel = document.getElementById('mobileWorkspacePanel');
      if(!trigger || !icon || !sheet || !panel) return;
      function applyIcon(){
        const ws = getActiveWorkspace();
        icon.src = ws.icon;
        icon.alt = ws.name;
      }
      function openSheet(){
        sheet.classList.remove('pointer-events-none');
        sheet.style.opacity = '1';
        panel.style.transform = 'translateY(0%)';
      }
      function closeSheet(){
        sheet.style.opacity = '0';
        panel.style.transform = 'translateY(100%)';
        setTimeout(()=>{ sheet.classList.add('pointer-events-none'); }, 200);
      }
      trigger.addEventListener('click', (e)=>{ e.stopPropagation(); openSheet(); });
      sheet.addEventListener('click', (e)=>{ if (e.target === sheet) closeSheet(); });
      document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') closeSheet(); });
      sheet.querySelectorAll('.mobile-workspace-option').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = btn.getAttribute('data-workspace-id');
          if (id) {
            setActiveWorkspace(id);
            applyIcon();
            const deskIcon = document.getElementById('workspaceSwitcherIcon');
            const found = WORKSPACES.find(w => w.id === id);
            if (deskIcon && found) deskIcon.src = found.icon;
          }
          closeSheet();
        });
      });
      applyIcon();
    }

    let CURRENT = null;
    window.addEventListener('hashchange', () => {
      requestAnimationFrame(() => { render(); wireSidebarIcons(); });
    });
    document.addEventListener('DOMContentLoaded', () => {
      setTheme(getTheme());
      initWorkspaceTabs();
      if (!location.hash) location.hash = '#/auth/login';
      render();
    });
    function isAuth(h){ return /^#\/auth\//.test(h); }
    function isApp(h) { return /^#\/app\//.test(h); }
    function navigate(to){ if (location.hash !== to) location.hash = to; }

    function render(){
      const h = location.hash || '#/auth/login';
      if (h === CURRENT) return;     
      CURRENT = h;

      const root = document.querySelector('#app[data-root]');
      if (!root) throw new Error('Missing #app[data-root]');
      
      try {
        if (isAuth(h)) {
            root.innerHTML = renderAuth(h);
            wireAuthThemeToggle();
            wireSwitcherByHref();
            setAuthLogoByTheme();
            tweakAuthInputPadding(11);
            normalizeAuthHrefs();
            installSafeNavOnce();
            wireCodeBoxes();
            wireGoogleButtons();
            wirePasswordEyesAndMatch('regPass','regPass2','regToggle1','regToggle2','regMsg','regSubmit');
            wirePasswordEyesAndMatch('rstPass','rstPass2','rstToggle1','rstToggle2','rstMsg','rstBtn');
            wireSinglePasswordEye('loginPass','loginToggleEye');
        } else if (isApp(h)) {
            root.innerHTML = renderAppShell(h);
            openTabForHash(h);
            renderWorkspaceTabs();
            wireAppShell(h);
            installSafeNavOnce();
            if (h === '#/app/performance') wireReportsEvents();
            if (h === '#/app/contacts') wireContactsEvents();
            
            const companyMatch = h.match(/^#\/app\/contacts\/company\/(\d+)$/);
            if (companyMatch) wireProfileEvents('company', parseInt(companyMatch[1]));
            
            const personMatch = h.match(/^#\/app\/contacts\/person\/(\d+)$/);
            if (personMatch) wireProfileEvents('person', parseInt(personMatch[1]));
        } else {
            if (h === '#/app' || h === '#/app/') navigate('#/app/me/tasks');
            else navigate('#/auth/login');
        }
      } catch (err) {
        console.error('Render failed:', err);
        root.innerHTML = `<div class="p-8 text-red-500"><h1>Render Error</h1><pre>${err.message}</pre></div>`;
      }
    }

    /* ========= AUTH VIEWS (unchanged) ========= */
    function renderAuth(hash) {
      let pageContent;
      switch(hash) {
        case '#/auth/forgot': pageContent = renderForgot(); break;
        case '#/auth/check-email': pageContent = renderCheckEmail(); break;
        case '#/auth/reset': pageContent = renderReset(); break;
        case '#/auth/success': pageContent = renderForgotSuccess(); break;
        case '#/auth/verify-code': pageContent = renderVerifyCode(); break;
        case '#/auth/verify-success': pageContent = renderVerifySuccess(); break;
        case '#/auth/register':
        case '#/auth/login':
        default:
          const isLogin = (hash !== '#/auth/register');
          const isRegister = !isLogin;
          const title = isLogin ? 'Log in to your account' : 'Create your account';
          const sub = isLogin ? 'Welcome back! Please enter your details.' : 'Let’s get you set up.';
          pageContent = `
            <div class="relative z-10 w-full flex flex-col items-center px-4 sm:px-6 py-12">
              <div class="w-full flex justify-center mb-6">
                <img class="auth-logo block" alt="Net Net" style="width:clamp(120px,33%,160px);height:auto;">
              </div>
              <h1 class="text-4xl font-semibold text-gray-900 dark:text-white">${title}</h1>
              <p class="mt-2 text-sm text-gray-600 dark:text-white/70">${sub}</p>
              <div class="auth-switch mt-6 mb-4 flex justify-center">
                <div class="switch-shell auth-switcher-inner">
                  <a href="#/auth/login" role="tab"  class="switch-tab text-gray-700 dark:text-white/85">Log in</a>
                  <a href="#/auth/register" role="tab" class="switch-tab text-gray-700 dark:text-white/85">Sign up</a>
                </div>
              </div>
              <div class="auth-card mt-6 border border-gray-200 bg-white shadow-lg p-6 md:p-8 dark:border-white/10 dark:bg-[#1F2430]">
                ${isRegister ? renderRegisterForm() : renderLoginForm()}
              </div>
              <p class="mt-6 text-sm text-gray-600 dark:text-white/70">
                ${isRegister ? 'Already have an account? <a class="underline" href="#/auth/login">Log in</a>' : "Don't have an account? <a class='underline' href='#/auth/register'>Sign up</a>"}
              </p>
            </div>`;
      }
      const bottomNote = `
        <div class="auth-bottom-note">
          <span>Net Net is workflow management software, built to measure performance to make profitability more predictable.
            Learn More at <a href="https://hellonetnet.com" target="_blank" rel="noopener">hellonetnet.com</a>.
          </span>
        </div>`;
      return `
        <div class="relative min-h-[100svh] bg-white dark:bg-black text-gray-900 dark:text-white">
          <div class="absolute top-0 inset-x-0 flex justify-end p-4 z-20">
            <button id="authThemeBtn" type="button" class="flex items-center gap-2 rounded-md border px-3 py-2 text-sm border-black/10 text-gray-700 hover:bg-black/5 dark:border-white/15 dark:text-white/80 dark:hover:bg-white/10">
              <span class="inline-flex items-center dark:hidden"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="4"></circle><path d="M12 1v3M12 20v3M4.22 4.22l2.12 2.12M17.66 17.66l2.12 2.12M1 12h3M20 12h3M4.22 19.78l2.12-2.12M17.66 6.34l2.12-2.12"/></svg><span class="ml-1">Light</span></span>
              <span class="hidden dark:inline-flex items-center"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg><span class="ml-1">Dark</span></span>
            </button>
          </div>
          <div class="auth-grid"><div class="grid-box"></div></div>
          ${pageContent}
          ${bottomNote}
        </div>`;
    }
    // ... Auth Forms (login, register, forgot, etc) omitted for brevity as they are unchanged ...
    function renderLoginForm(){ return `<form class="space-y-4" onsubmit="event.preventDefault(); navigate(LOGIN_SUCCESS_ROUTE);"> <div class="space-y-1"> <label class="text-sm block text-gray-700 dark:text-white/80">Email</label> <input type="email" required placeholder="Enter your email" class="w-full h-11 rounded-md ring-1 ring-gray-300 bg-white text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-netnet-purple dark:bg-white/5 dark:text-white dark:placeholder-white/40 dark:ring-white/15"/> </div> <div class="space-y-1"> <label class="text-sm block text-gray-700 dark:text-white/80">Password</label> <div class="pwd-wrap"> <input id="loginPass" type="password" required placeholder="••••••••" class="w-full h-11 pr-10 rounded-md ring-1 ring-gray-300 bg-white text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-netnet-purple dark:bg-white/5 dark:text-white dark:placeholder-white/40 dark:ring-white/15"/> <button type="button" id="loginToggleEye" class="pwd-eye" aria-label="Show password"></button> </div> </div> <div class="flex items-center justify-between text-sm"> <label class="inline-flex items-center gap-2 text-gray-600 dark:text-white/70"> <input type="checkbox" class="rounded border-gray-300 dark:border-white/30"> Remember for 30 days </label> <a href="#/auth/forgot" class="text-netnet-purple">Forgot password?</a> </div> <button class="w-full h-11 rounded-md bg-netnet-purple text-white font-semibold">Sign in</button> <div class="relative my-2"> <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-200 dark:border-white/10"></div></div> <div class="relative flex justify-center"> <span class="px-2 text-xs text-gray-500 dark:text-white/60 bg-white dark:bg-[#1F2430]">OR</span> </div> </div> <button id="googleLoginBtn" type="button" class="w-full h-11 rounded-md border border-gray-300 text-gray-900 flex items-center justify-center gap-2 dark:border-white/20 dark:text-white"> <img src="https://www.google.com/favicon.ico" alt="" class="h-4 w-4"> Continue with Google </button> </form>`; }
    function renderRegisterForm(){ return `<form id="registerForm" class="space-y-4" onsubmit="event.preventDefault(); if (document.getElementById('regSubmit').disabled === false) { navigate(REGISTER_SUCCESS_ROUTE); }"> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"> <div class="space-y-1"> <label class="text-sm block text-gray-700 dark:text-white/80">First name</label> <input id="regFirst" type="text" required placeholder="First name" class="w-full h-11 rounded-md ring-1 ring-gray-300 bg-white text-gray-900 placeholder-gray-400 px-3 focus:ring-2 focus:ring-netnet-purple dark:bg-white/5 dark:text-white dark:placeholder-white/40 dark:ring-white/15"> </div> <div class="space-y-1"> <label class="text-sm block text-gray-700 dark:text-white/80">Last name</label> <input id="regLast" type="text" required placeholder="Last name" class="w-full h-11 rounded-md ring-1 ring-gray-300 bg-white text-gray-900 placeholder-gray-400 px-3 focus:ring-2 focus:ring-netnet-purple dark:bg-white/5 dark:text-white dark:placeholder-white/40 dark:ring-white/15"> </div> </div> <div class="space-y-1"> <label class="text-sm block text-gray-700 dark:text-white/80">Email</label> <input id="regEmail" type="email" required placeholder="you@example.com" class="w-full h-11 rounded-md ring-1 ring-gray-300 bg-white text-gray-900 placeholder-gray-400 px-3 focus:ring-2 focus:ring-netnet-purple dark:bg-white/5 dark:text-white dark:placeholder-white/40 dark:ring-white/15"> </div> <div class="space-y-1"> <label class="text-sm block text-gray-700 dark:text-white/80">Password</label> <div class="pwd-wrap"> <input id="regPass" type="password" required placeholder="••••••••" class="w-full h-11 pr-10 rounded-md ring-1 ring-gray-300 bg-white text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-netnet-purple dark:bg-white/5 dark:text-white dark:placeholder-white/40 dark:ring-white/15"/> <button type="button" id="regToggle1" class="pwd-eye" aria-label="Show password"></button> </div> </div> <div class="space-y-1"> <label class="text-sm block text-gray-700 dark:text-white/80">Repeat password</label> <div class="pwd-wrap"> <input id="regPass2" type="password" required placeholder="••••••••" class="w-full h-11 pr-10 rounded-md ring-1 ring-gray-300 bg-white text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-netnet-purple dark:bg-white/5 dark:text-white dark:placeholder-white/40 dark:ring-white/15"/> <button type="button" id="regToggle2" class="pwd-eye" aria-label="Show repeat password"></button> </div> </div> <p id="regMsg" class="text-sm h-5 text-red-500/90"></p> <button id="regSubmit" class="w-full h-11 rounded-md bg-netnet-purple text-white font-semibold disabled:opacity-50" disabled> Create account </button> <div class="relative my-2"> <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-200 dark:border-white/10"></div></div> <div class="relative flex justify-center"> <span class="px-2 text-xs text-gray-500 dark:text-white/60 bg-white dark:bg-[#1F2430]">OR</span> </div> </div> <button id="googleSignupBtn" type="button" class="w-full h-11 rounded-md border border-gray-300 text-gray-900 flex items-center justify-center gap-2 dark:border-white/20 dark:text-white"> <img src="https://www.google.com/favicon.ico" alt="" class="h-4 w-4"> Continue with Google </button> </form>`; }
    function renderForgot(){ return `<div class="relative z-10"> ${authHeader('Forgot password')} ${authSwitcherHidden()} <div class="auth-center-wrap"> <div class="auth-card mt-6 border border-gray-200 bg-white shadow-lg p-6 md:p-8 dark:border-white/10 dark:bg-[#1F2430]"> <form class="space-y-4" onsubmit="event.preventDefault(); navigate('#/auth/check-email');"> <div class="space-y-1"> <label class="text-sm block text-gray-700 dark:text-white/80">Email</label> <input type="email" required placeholder="Enter your email" class="w-full h-11 rounded-md ring-1 ring-gray-300 bg-white text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-netnet-purple dark:bg-white/5 dark:text-white dark:placeholder-white/40 dark:ring-white/15"/> </div> <button class="w-full h-11 rounded-md bg-netnet-purple text-white font-semibold">Send reset link</button> </form> </div> </div> ${authFooterLink("Remembered it?", "#/auth/login", "Back to log in")} </div>`; }
    function renderCheckEmail(){ return `<div class="relative z-10"> ${authHeader('Check your email','We sent a reset link to your inbox.')} ${authSwitcherHidden()} <div class="auth-center-wrap"> <div class="auth-card mt-6 border border-gray-200 bg-white shadow-lg p-6 md:p-8 dark:border-white/10 dark:bg-[#1F2430] text-center"> <p class="text-sm text-gray-600 dark:text-white/70 mb-4">Didn’t get it?</p> <a href="#/auth/reset" class="inline-flex items-center justify-center h-11 px-5 rounded-md bg-netnet-purple text-white font-semibold">Open reset</a> </div> </div> ${authFooterLink("", "#/auth/login", "Back to log in")} </div>`; }
    function renderReset(){ return `<div class="relative z-10"> ${authHeader('Set new password')} ${authSwitcherHidden()} <div class="auth-center-wrap"> <div class="auth-card mt-6 border border-gray-200 bg-white shadow-lg p-6 md:p-8 dark:border-white/10 dark:bg-[#1F2430]"> <form id="resetForm" class="space-y-4" onsubmit="event.preventDefault(); if (document.getElementById('rstBtn').disabled === false) { navigate(RESET_SUCCESS_ROUTE); }"> <div class="space-y-1"> <label class="text-sm block text-gray-700 dark:text-white/80">New password</label> <div class="pwd-wrap"> <input id="rstPass" type="password" required placeholder="••••••••" class="w-full h-11 pr-10 rounded-md ring-1 ring-gray-300 bg-white text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-netnet-purple dark:bg-white/5 dark:text-white dark:placeholder-white/40 dark:ring-white/15"/> <button type="button" id="rstToggle1" class="pwd-eye" aria-label="Show password"></button> </div> </div> <div class="space-y-1"> <label class="text-sm block text-gray-700 dark:text-white/80">Confirm password</label> <div class="pwd-wrap"> <input id="rstPass2" type="password" required placeholder="••••••••" class="w-full h-11 pr-10 rounded-md ring-1 ring-gray-300 bg-white text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-netnet-purple dark:bg-white/5 dark:text-white dark:placeholder-white/40 dark:ring-white/15"/> <button type="button" id="rstToggle2" class="pwd-eye" aria-label="Show confirm password"></button> </div> </div> <p id="rstMsg" class="text-sm h-5 text-red-500/90"></p> <button id="rstBtn" class="w-full h-11 rounded-md bg-netnet-purple text-white font-semibold disabled:opacity-50" disabled> Update password </button> </form> </div> </div> ${authFooterLink("", "#/auth/login", "Back to log in")} </div>`; }
    function renderForgotSuccess(){ return `<div class="relative z-10"> ${authHeader('Password updated')} ${authSwitcherHidden()} <div class="auth-center-wrap"> <div class="auth-card mt-6 border border-gray-200 bg-white shadow-lg p-6 md:p-8 dark:border-white/10 dark:bg-[#1F2430] text-center"> <a href="#/auth/login" class="inline-flex items-center justify-center h-11 px-5 rounded-md bg-netnet-purple text-white font-semibold">Return to log in</a> </div> </div> </div>`; }
    function renderVerifyCode(){ return `<div class="relative z-10"> ${authHeader('Check your email','Enter the 4-digit code we sent.')} ${authSwitcherHidden()} <div class="auth-center-wrap"> <div class="auth-card mt-6 border border-gray-200 bg-white shadow-lg p-6 md:p-8 dark:border-white/10 dark:bg-[#1F2430]"> <form class="space-y-6" onsubmit="event.preventDefault(); navigate('#/auth/verify-success');"> <div class="code-grid"> ${Array.from({length:4}).map((_,i)=>` <input class="code-box" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Digit ${i+1}" data-code-index="${i}"> `).join('')} </div> <button class="w-full h-11 rounded-md bg-netnet-purple text-white font-semibold mt-2">Verify email</button> <p class="text-sm text-gray-600 dark:text-white/70 text-center">Didn’t receive the email? <a href="#/auth/verify-code" class="underline">Click to resend</a></p> </form> <div class="mt-4 text-center"> <a href="#/auth/login" class="text-sm underline">Back to log in</a> </div> </div> </div> </div>`; }
    function renderVerifySuccess(){ return `<div class="relative z-10"> ${authHeader('Email verified')} ${authSwitcherHidden()} <div class="auth-center-wrap"> <div class="auth-card mt-6 border border-gray-200 bg-white shadow-lg p-6 md:p-8 dark:border-white/10 dark:bg-[#1F2430] text-center"> <a href="#/app/me/tasks" class="inline-flex items-center justify-center h-11 px-5 rounded-md bg-netnet-purple text-white font-semibold">Continue</a> </div> </div> </div>`; }
    function authHeader(title, sub=''){ const isDark = document.documentElement.classList.contains('dark'); const logo = isDark ? 'https://hellonetnet.com/wp-content/uploads/2024/12/logo-reverse.svg' : 'https://hellonetnet.com/wp-content/uploads/2024/12/logo-standard.svg'; return `<div class="w-full flex flex-col items-center px-4 sm:px-6 py-12 relative"> <div class="w-full flex justify-center mb-6"> <img class="auth-logo block" src="${logo}" alt="Net Net" style="width:clamp(120px,33%,160px);height:auto;"> </div> <h1 class="text-4xl font-semibold text-gray-900 dark:text-white">${title}</h1> ${sub ? `<p class="mt-2 text-sm text-gray-600 dark:text-white/70">${sub}</p>` : ``} </div>`; }
    function authFooterLink(prefix, href, text){ return `<p class="mt-6 text-sm text-gray-600 dark:text-white/70 text-center">${prefix ? prefix + ' ' : ''}<a href="${href}" class="underline">${text}</a></p>`; }
    function authSwitcherHidden(){ return ``; }
    function tweakAuthInputPadding(px) { const sel = '.auth-card input[type="email"], .auth-card input[type="password"]'; document.querySelectorAll(sel).forEach(el => { el.style.paddingTop = px + 'px'; el.style.paddingBottom = px + 'px'; el.style.lineHeight = '1.35'; }); }

    /* ========= AUTH WIRING ========= */
    function wireAuthThemeToggle() {
      const btn = document.getElementById('authThemeBtn');
      if (btn) {
        btn.onclick = () => {
          const isDark = document.documentElement.classList.contains('dark');
          setTheme(isDark ? 'light' : 'dark');
          setAuthLogoByTheme();
          if(isApp(location.hash)) { refreshDynamicIcons(); }
        };
      }
    }
    function setAuthLogoByTheme(){
      const isDark = document.documentElement.classList.contains('dark');
      const logos = document.querySelectorAll('.auth-logo');
      if(logos.length > 0){
        const src = isDark ? 'https://hellonetnet.com/wp-content/uploads/2024/12/logo-reverse.svg' : 'https://hellonetnet.com/wp-content/uploads/2024/12/logo-standard.svg';
        logos.forEach(logo => logo.src = src);
      }
    }
    function wireSwitcherByHref(){
      const hash = location.hash || '#/auth/login';
      document.querySelectorAll('.switch-tab').forEach(tab => {
        const href = tab.getAttribute('href');
        tab.setAttribute('aria-selected', href === hash);
      });
    }
    function normalizeAuthHrefs(){
      document.querySelectorAll('a[href]').forEach(a=>{
        let h = a.getAttribute('href');
        if (h && h.startsWith('#')) a.href = new URL(h, location.href).href;
      });
    }
    function wireCodeBoxes(){
      const inputs = Array.from(document.querySelectorAll('.code-box'));
      if (inputs.length === 0) return;
      inputs.forEach((input, index) => {
        input.addEventListener('keydown', e => {
          if (e.key >= 0 && e.key <= 9) {
            inputs[index].value = '';
            if (index + 1 < inputs.length) {
              setTimeout(() => inputs[index + 1].focus(), 10);
            }
          } else if (e.key === 'Backspace') {
            if (index > 0) {
              setTimeout(() => inputs[index - 1].focus(), 10);
            }
          }
        });
      });
    }
    function wireGoogleButtons(){
      const loginBtn = document.getElementById('googleLoginBtn');
      const signupBtn = document.getElementById('googleSignupBtn');
      if(loginBtn) loginBtn.onclick = () => navigate(LOGIN_SUCCESS_ROUTE);
      if(signupBtn) signupBtn.onclick = () => navigate(REGISTER_SUCCESS_ROUTE);
    }
    const EYE_OPEN = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>`;
    const EYE_CLOSED = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/><line x1="2" x2="22" y1="2" y2="22"/></svg>`;
    function wireSinglePasswordEye(inputId, eyeId) {
      const input = document.getElementById(inputId);
      const eye = document.getElementById(eyeId);
      if (!input || !eye) return;
      let shown = false;
      eye.innerHTML = EYE_CLOSED;
      eye.onclick = () => {
        shown = !shown;
        input.type = type = shown ? 'text' : 'password';
        eye.innerHTML = shown ? EYE_OPEN : EYE_CLOSED;
      };
    }
    function wirePasswordEyesAndMatch(p1Id, p2Id, eye1Id, eye2Id, msgId, btnId) {
      wireSinglePasswordEye(p1Id, eye1Id);
      wireSinglePasswordEye(p2Id, eye2Id);
      const p1 = document.getElementById(p1Id);
      const p2 = document.getElementById(p2Id);
      const msg = document.getElementById(msgId);
      const btn = document.getElementById(btnId);
      if (!p1 || !p2 || !msg || !btn) return;
      const listener = () => {
        const v1 = p1.value;
        const v2 = p2.value;
        if (v1 && v2) {
          if (v1 !== v2) {
            msg.textContent = 'Passwords do not match.';
            btn.disabled = true;
          } else {
            msg.textContent = '';
            btn.disabled = false;
          }
        } else {
          msg.textContent = '';
          btn.disabled = true;
        }
      };
      p1.addEventListener('input', listener);
      p2.addEventListener('input', listener);
    }
    
    // Me section icon assets
    const ME_ICONS = {
      light: { idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/Me-Idle.svg', active:'https://hellonetnet.com/wp-content/uploads/2025/11/Me-Active.svg' },
      dark: { idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/Me-Idle-white.svg', active:'https://hellonetnet.com/wp-content/uploads/2025/11/Me-Active-white.svg' }
    };
    const CONTACTS_ICONS = {
      light: { idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/Contacts-Idle.svg', active:'https://hellonetnet.com/wp-content/uploads/2025/11/Contacts-Active.svg' },
      dark: { idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/Contacts-Idle-white.svg', active:'https://hellonetnet.com/wp-content/uploads/2025/11/Contacts-Active-white.svg' }
    };
    const SALES_ICONS = {
      light: { idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/Sales-Idle.svg', active:'https://hellonetnet.com/wp-content/uploads/2025/11/Sales-Active.svg' },
      dark: { idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/Sales-Idle-white.svg', active:'https://hellonetnet.com/wp-content/uploads/2025/11/Sales-Active-white.svg' }
    };
    const JOBS_ICONS = {
      light: { idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/Jobs-Idle.svg', active:'https://hellonetnet.com/wp-content/uploads/2025/11/Jobs-Active.svg' },
      dark: { idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/Jobs-Idle-white.svg', active:'https://hellonetnet.com/wp-content/uploads/2025/11/Jobs-Active-white.svg' }
    };
    const QT_ICONS = {
      light: { idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/QuickTasks-Idle.svg', active:'https://hellonetnet.com/wp-content/uploads/2025/11/QuickTasks-Active.svg' },
      dark: { idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/QuickTasks-Idle-white.svg', active:'https://hellonetnet.com/wp-content/uploads/2025/11/QuickTasks-Active-white.svg' }
    };
    const CHAT_ICONS = {
      light: { idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/Chat-Idle.svg', active:'https://hellonetnet.com/wp-content/uploads/2025/11/Chat-Active.svg' },
      dark: { idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/Chat-Idle-white.svg', active:'https://hellonetnet.com/wp-content/uploads/2025/11/Chat-Active-white.svg' }
    };
    const BOT_ICONS = {
      light: { idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/AI-Idle.svg', active:'https://hellonetnet.com/wp-content/uploads/2025/11/AI-Active.svg' },
      dark: { idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/AI-Idle-white.svg', active:'https://hellonetnet.com/wp-content/uploads/2025/11/AI-Active-white.svg' }
    };
    
    const CHAT_UI_ICONS = {
       clip: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>`,
       mic: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>`,
       send: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>`
    };

    function meIconPaint(active){
      const img = document.getElementById('meFeaturedIcon');
      if(!img) return;
      const dark = document.documentElement.classList.contains('dark');
      const src = dark ? (active ? ME_ICONS.dark.active : ME_ICONS.dark.idle) : (active ? ME_ICONS.light.active : ME_ICONS.light.idle);
      if (img.getAttribute('src') !== src) img.setAttribute('src', src);
    }
    function meIconSwap(hover){ meIconPaint(!!hover); }

    function contactsIconPaint(active){
      const img = document.getElementById('contactsFeaturedIcon');
      if(!img) return;
      const dark = document.documentElement.classList.contains('dark');
      const src = dark ? (active ? CONTACTS_ICONS.dark.active : CONTACTS_ICONS.dark.idle) : (active ? CONTACTS_ICONS.light.active : CONTACTS_ICONS.light.idle);
      if (img.getAttribute('src') !== src) img.setAttribute('src', src);
    }
    function contactsIconSwap(hover){ contactsIconPaint(!!hover); }

    function salesIconPaint(active){
      const el = document.getElementById('salesFeaturedIcon');
      if (!el) return;
      const dark = document.documentElement.classList.contains('dark');
      const src = dark ? (active ? SALES_ICONS.dark.active : SALES_ICONS.dark.idle) : (active ? SALES_ICONS.light.active : SALES_ICONS.light.idle);
      if (el.getAttribute('src') !== src) el.setAttribute('src', src);
    }
    function salesIconSwap(hover){ salesIconPaint(!!hover); }

    function jobsIconPaint(active){
      const el = document.getElementById('jobsFeaturedIcon');
      if (!el) return;
      const dark = document.documentElement.classList.contains('dark');
      const src = dark ? (active ? JOBS_ICONS.dark.active : JOBS_ICONS.dark.idle) : (active ? JOBS_ICONS.light.active : JOBS_ICONS.light.idle);
      if (el.getAttribute('src') !== src) el.setAttribute('src', src);
    }
    function jobsIconSwap(hover){ jobsIconPaint(!!hover); }

    function quickTasksIconPaint(active) {
      const el = document.getElementById('quickTasksFeaturedIcon');
      if (!el) return;
      const dark = document.documentElement.classList.contains('dark');
      const src = dark ? (active ? QT_ICONS.dark.active : QT_ICONS.dark.idle) : (active ? QT_ICONS.light.active : QT_ICONS.light.idle);
      if (el.getAttribute('src') !== src) el.setAttribute('src', src);
    }
    function quickTasksIconSwap(hover) { quickTasksIconPaint(!!hover); }

    function chatIconPaint(active) {
      const el = document.getElementById('chatFeaturedIcon');
      if (!el) return;
      const dark = document.documentElement.classList.contains('dark');
      const src = dark ? (active ? CHAT_ICONS.dark.active : CHAT_ICONS.dark.idle) : (active ? CHAT_ICONS.light.active : CHAT_ICONS.light.idle);
      if (el.getAttribute('src') !== src) el.setAttribute('src', src);
    }
    function chatIconSwap(hover) { chatIconPaint(!!hover); }
    
    function botIconPaint(active) {
      const el = document.getElementById('botFeaturedIcon');
      if (!el) return;
      const dark = document.documentElement.classList.contains('dark');
      const src = dark ? (active ? BOT_ICONS.dark.active : BOT_ICONS.dark.idle) : (active ? BOT_ICONS.light.active : BOT_ICONS.light.idle);
      if (el.getAttribute('src') !== src) el.setAttribute('src', src);
    }
    function botIconSwap(hover) { botIconPaint(!!hover); }

    function nnuIconPaint(active) {
      const el = document.getElementById('nnuFeaturedIcon');
      if (!el) return;
      const dark = document.documentElement.classList.contains('dark');
      const src = dark ? (active ? ICONS.nnu.dark.active : ICONS.nnu.dark.idle) : (active ? ICONS.nnu.light.active : ICONS.nnu.light.idle);
      if (el.getAttribute('src') !== src) el.setAttribute('src', src);
    }
    function nnuIconSwap(hover) { nnuIconPaint(!!hover); }

    const __appThemeObs = new MutationObserver(()=> {
      const hash = location.hash || '';
      if (hash.startsWith('#/app/me')) meIconPaint(false);
      if (hash.startsWith('#/app/contacts')) contactsIconPaint(false);
      if (hash.startsWith('#/app/sales')) salesIconPaint(false);
      if (hash.startsWith('#/app/jobs')) jobsIconPaint(false);
      if (hash.startsWith('#/app/quick-tasks')) quickTasksIconPaint(false);
      if (hash.startsWith('#/app/chat')) chatIconPaint(false);
      if (hash.startsWith('#/app/net-net-bot')) botIconPaint(false);
      if (hash.startsWith('#/app/net-net-u')) nnuIconPaint(false);
    });
    __appThemeObs.observe(document.documentElement, { attributes:true, attributeFilter:['class'] });

    /* ========= APP SHELL ========= */
    const APP_ICONS = {
      settings: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2.12l-.15.1a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1 0-2.12l.15-.1a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>`,
      avatar: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`,
      logout: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>`,
      close: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`
    };
    const ICONS = {
      me: { light: { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/Me-Idle.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/Me-Active.svg' }, dark:  { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/Me-Idle-white.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/Me-Active-white.svg' } },
      contacts: { light: { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/Contacts-Idle.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/Contacts-Active.svg' }, dark:  { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/Contacts-Idle-white.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/Contacts-Active-white.svg' } },
      sales: { light: { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/Sales-Idle.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/Sales-Active.svg' }, dark:  { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/Sales-Idle-white.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/Sales-Active-white.svg' } },
      jobs: { light: { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/Jobs-Idle.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/Jobs-Active.svg' }, dark:  { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/Jobs-Idle-white.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/Jobs-Active-white.svg' } },
      quick: { light: { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/QuickTasks-Idle.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/QuickTasks-Active.svg' }, dark:  { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/QuickTasks-Idle-white.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/QuickTasks-Active-white.svg' } },
      chat: { light: { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/Chat-Idle.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/Chat-Active.svg' }, dark:  { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/Chat-Idle-white.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/Chat-Active-white.svg' } },
      performance: { light:  { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/Reports-Idle.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/Reports-Active.svg' }, dark:   { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/Reports-Idle.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/Reports-Active.svg' } },
      reports: { light:  { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/Reports-Idle.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/Reports-Active.svg' }, dark:   { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/Reports-Idle.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/Reports-Active.svg' } },
      nnu: { light: { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/NNU-Idle.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/NNU-Active.svg' }, dark:  { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/NNU-Idle-white.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/NNU-Active-white.svg' } },
      bot: { light: { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/AI-Idle.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/AI-Active.svg' }, dark:  { idle: 'https://hellonetnet.com/wp-content/uploads/2025/11/AI-Idle-white.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/AI-Active-white.svg' } }
    };
    
    const TIMER_ICONS = {
      idle:  'https://hellonetnet.com/wp-content/uploads/2025/11/Time-Idle-white.svg',
      active:'https://hellonetnet.com/wp-content/uploads/2025/11/Time-Active-white.svg'
    };

    function wireAppTimer(){
      const button = document.getElementById('timerBtn');
      const img = document.getElementById('timerIcon');
      const mButton = document.getElementById('mobileTimerBtn');
      const mImg = document.getElementById('mobileTimerIcon');
      const key = 'timerActive';
      let running = !!(JSON.parse(localStorage.getItem(key)));
      const touch = window.matchMedia && window.matchMedia('(hover:none)').matches;
      function paint(active) {
        const useActive = touch ? true : !!active;
        const url = useActive ? TIMER_ICONS.active : TIMER_ICONS.idle;
        if (img && img.getAttribute('src') !== url) img.setAttribute('src', url);
        if (mImg) mImg.setAttribute('src', TIMER_ICONS.active);
      }
      paint(running);
      const toggle = () => {
        running = !running;
        localStorage.setItem(key, JSON.stringify(running));
        paint(running);
      };
      if (button) {
        if (!touch) {
          button.onmouseenter = () => paint(true);
          button.onmouseleave = () => paint(running);
        } else {
          button.onmouseenter = button.onmouseleave = null;
        }
        button.onclick = toggle;
      }
      if (mButton) { mButton.onclick = toggle; }
    }

    function __isDark(){ return document.documentElement.classList.contains('dark'); }
    function __norm(s){ return (s||'').replace(/\/+$/,''); }
    function __isMeActive(h){
      const hh = __norm(h||'');
      return hh === '#/app' || hh === '#/app/' || hh.startsWith('#/app/me');
    }
    function __paint(img, active){
      const theme = __isDark() ? 'dark' : 'light';
      const attr  = active ? `data-${theme}-active` : `data-${theme}-idle`;
      const url   = img.getAttribute(attr);
      if (url && img.getAttribute('src') !== url) img.setAttribute('src', url);
    }

    function wireSidebarIcons(){
      const canHover = matchMedia && matchMedia('(hover:hover)').matches;
      const hash = __norm(location.hash || '#/app');
      document.querySelectorAll('nav a[href^="#/app"]').forEach(a=>{
        const img = a.querySelector('img[data-icon]');
        if (!img) return;
        const href  = __norm(a.getAttribute('href') || '');
        const key   = (img.getAttribute('data-icon')||'').toLowerCase().trim();
        const isActive = (key === 'me') ? __isMeActive(hash) : (hash === href || hash.startsWith(href + '/'));
        __paint(img, isActive);
        a.onmouseenter = a.onmouseleave = a.onfocus = a.onblur = null;
        if (canHover) {
          a.onmouseenter = ()=> __paint(img, true);
          a.onmouseleave = ()=> {
            const now = __norm(location.hash || '#/app');
            const activeNow = (key === 'me') ? __isMeActive(now) : (now === href || now.startsWith(href + '/'));
            __paint(img, activeNow);
          };
          a.onfocus = a.onmouseenter;
          a.onblur  = a.onmouseleave;
        }
      });
    }

    function refreshDynamicIcons(){
      wireSidebarIcons();
      wireTopBarLogo();
      wireMobileHeaderLogo();
      const ti = document.getElementById('timerIcon');
      if (ti) {
        const active = !!JSON.parse(localStorage.getItem('timerActive') || 'false');
        const touch = window.matchMedia && window.matchMedia('(hover:none)').matches;
        ti.src = (touch || active) ? TIMER_ICONS.active : TIMER_ICONS.idle;
      }
    }

    const SIDEBAR_LINKS = [
      { 
        name: 'Me', 
        path: '#/app/me/tasks', 
        key: 'me',
        subs: [
            { name: 'My Tasks', path: '#/app/me/tasks' },
            { name: 'My Time', path: '#/app/me/time' },
            { name: 'My Performance', path: '#/app/me/performance' },
        ]
      },
      { name: 'Net Net Bot', path: '#/app/net-net-bot', key: 'bot' },
      { name: 'Contacts', path: '#/app/contacts', key: 'contacts' },
      { name: 'Sales', path: '#/app/sales', key: 'sales' },
      { name: 'Jobs', path: '#/app/jobs', key: 'jobs' },
      { name: 'Quick Tasks', path: '#/app/quick-tasks', key: 'quick' },
      { name: 'Chat', path: '#/app/chat', key: 'chat' },
      { name: 'Performance', path: '#/app/performance', key: 'performance' },
      { name: 'Net Net U', path: '#/app/net-net-u', key: 'nnu' },
    ];
    
    function getDateShifted(days) {
        const d = new Date();
        d.setDate(d.getDate() + days);
        return d.toISOString().split('T')[0];
    }
    
    // Mock Data
    const mockReportData = {
        jobs: [
            { id: 1, name: 'NCBF Web Redesign', client: 'National Cherry Blossom Festival', estHours: 200, actualHours: 80, plannedEnd: getDateShifted(14), startDate: getDateShifted(-20), wipPressure: 0.85 },
            { id: 2, name: 'Quantum Leap Website', client: 'Future Systems', estHours: 350, actualHours: 300, plannedEnd: getDateShifted(7), startDate: getDateShifted(-60), wipPressure: 1.2 },
            { id: 3, name: 'Data Migration Strategy', client: 'Legacy Corp', estHours: 120, actualHours: 125, plannedEnd: getDateShifted(-5), startDate: getDateShifted(-40), wipPressure: 1.5 },
            { id: 4, name: 'Mobile App Revamp', client: 'Appify', estHours: 500, actualHours: 150, plannedEnd: getDateShifted(45), startDate: getDateShifted(-10), wipPressure: 0.7 },
        ],
        deliverables: [
            { id: 101, jobId: 2, jobName: 'Quantum Leap Website', name: 'API Integration', owner: 'Sam', due: getDateShifted(-2), effortConsumed: 110, durationConsumed: 105, estHours: 40 }, 
            { id: 102, jobId: 3, jobName: 'Data Migration Strategy', name: 'Final Report Delivery', owner: 'Maria', due: getDateShifted(3), effortConsumed: 102, durationConsumed: 115, estHours: 20 }, 
            { id: 103, jobId: 2, jobName: 'Quantum Leap Website', name: 'Frontend Deployment', owner: 'Alex', due: getDateShifted(5), effortConsumed: 98, durationConsumed: 101, estHours: 60 }, 
            { id: 104, jobId: 4, jobName: 'Mobile App Revamp', name: 'Wireframes', owner: 'Sarah', due: getDateShifted(12), effortConsumed: 40, durationConsumed: 30, estHours: 80 }, 
        ]
    };

    const mockContactsData = [
  {
    id: 1,
    name: "Northbridge Digital",
    website: "northbridgedigital.com",
    linkedin: "linkedin.com/company/northbridgedigital",
    city: "New York",
    state: "NY",
    phone: "(212) 555-1000",
    email: "hello@northbridgedigital.com",
    address: "120 Madison Ave",
    zip: "10016",
    description: "Boutique digital strategy and web development studio.",
    industry: "Digital Services",
    socials: { twitter: "@northbridgedgtl", facebook: "northbridgedigital", instagram: "@northbridgedgtl" },
    activities: [],
    people: [
      {
        id: 1001,
        name: "Emily Carter",
        title: "CEO",
        email: "emily.carter@northbridgedigital.com",
        phone: "(212) 555-1001",
        city: "New York",
        state: "NY",
        address: "12 W 23rd St",
        zip: "10010",
        activities: []
      },
      {
        id: 1002,
        name: "Michael Rivera",
        title: "CTO",
        email: "michael.rivera@northbridgedigital.com",
        phone: "(212) 555-1002",
        city: "New York",
        state: "NY",
        address: "44 W 21st St",
        zip: "10011",
        activities: []
      },
      {
        id: 1003,
        name: "Sophia Lee",
        title: "Director of UX",
        email: "sophia.lee@northbridgedigital.com",
        phone: "(212) 555-1003",
        city: "New York",
        state: "NY",
        address: "88 5th Ave",
        zip: "10011",
        activities: []
      },
      {
        id: 1004,
        name: "Daniel Kim",
        title: "Senior Frontend Engineer",
        email: "daniel.kim@northbridgedigital.com",
        phone: "(212) 555-1004",
        city: "New York",
        state: "NY",
        address: "23 E 19th St",
        zip: "10003",
        activities: []
      },
      {
        id: 1005,
        name: "Rachel Green",
        title: "Senior Project Manager",
        email: "rachel.green@northbridgedigital.com",
        phone: "(212) 555-1005",
        city: "New York",
        state: "NY",
        address: "17 W 14th St",
        zip: "10011",
        activities: []
      },
      {
        id: 1006,
        name: "Alex Johnson",
        title: "Full Stack Developer",
        email: "alex.johnson@northbridgedigital.com",
        phone: "(212) 555-1006",
        city: "New York",
        state: "NY",
        address: "50 Irving Pl",
        zip: "10003",
        activities: []
      },
      {
        id: 1007,
        name: "Priya Singh",
        title: "Product Designer",
        email: "priya.singh@northbridgedigital.com",
        phone: "(212) 555-1007",
        city: "New York",
        state: "NY",
        address: "301 W 24th St",
        zip: "10011",
        activities: []
      },
      {
        id: 1008,
        name: "James Miller",
        title: "Backend Engineer",
        email: "james.miller@northbridgedigital.com",
        phone: "(212) 555-1008",
        city: "New York",
        state: "NY",
        address: "5 E 22nd St",
        zip: "10010",
        activities: []
      },
      {
        id: 1009,
        name: "Olivia Brown",
        title: "Account Director",
        email: "olivia.brown@northbridgedigital.com",
        phone: "(212) 555-1009",
        city: "New York",
        state: "NY",
        address: "10 W 20th St",
        zip: "10011",
        activities: []
      },
      {
        id: 1010,
        name: "William Harris",
        title: "Marketing Strategist",
        email: "william.harris@northbridgedigital.com",
        phone: "(212) 555-1010",
        city: "New York",
        state: "NY",
        address: "220 7th Ave",
        zip: "10001",
        activities: []
      }
    ]
  },
  {
    id: 2,
    name: "Silverline Creative",
    website: "silverlinecreative.com",
    linkedin: "linkedin.com/company/silverlinecreative",
    city: "Chicago",
    state: "IL",
    phone: "(312) 555-2000",
    email: "info@silverlinecreative.com",
    address: "350 N Orleans St",
    zip: "60654",
    description: "Branding and campaign execution for growth-focused companies.",
    industry: "Marketing",
    socials: { twitter: "@silverlinecr", facebook: "silverlinecreative", instagram: "@silverlinecreative" },
    activities: [],
    people: [
      {
        id: 1011,
        name: "Laura Martinez",
        title: "Managing Partner",
        email: "laura.martinez@silverlinecreative.com",
        phone: "(312) 555-2001",
        city: "Chicago",
        state: "IL",
        address: "200 W Kinzie St",
        zip: "60654",
        activities: []
      },
      {
        id: 1012,
        name: "Brandon Scott",
        title: "Art Director",
        email: "brandon.scott@silverlinecreative.com",
        phone: "(312) 555-2002",
        city: "Chicago",
        state: "IL",
        address: "55 W Erie St",
        zip: "60654",
        activities: []
      },
      {
        id: 1013,
        name: "Hannah Wilson",
        title: "Copywriter",
        email: "hannah.wilson@silverlinecreative.com",
        phone: "(312) 555-2003",
        city: "Chicago",
        state: "IL",
        address: "19 E Ontario St",
        zip: "60611",
        activities: []
      },
      {
        id: 1014,
        name: "Kevin Turner",
        title: "Campaign Manager",
        email: "kevin.turner@silverlinecreative.com",
        phone: "(312) 555-2004",
        city: "Chicago",
        state: "IL",
        address: "500 N Dearborn St",
        zip: "60654",
        activities: []
      },
      {
        id: 1015,
        name: "Natalie Brooks",
        title: "Social Media Strategist",
        email: "natalie.brooks@silverlinecreative.com",
        phone: "(312) 555-2005",
        city: "Chicago",
        state: "IL",
        address: "221 W Hubbard St",
        zip: "60654",
        activities: []
      },
      {
        id: 1016,
        name: "Ethan Walker",
        title: "Senior Designer",
        email: "ethan.walker@silverlinecreative.com",
        phone: "(312) 555-2006",
        city: "Chicago",
        state: "IL",
        address: "850 N State St",
        zip: "60610",
        activities: []
      },
      {
        id: 1017,
        name: "Grace Allen",
        title: "Project Coordinator",
        email: "grace.allen@silverlinecreative.com",
        phone: "(312) 555-2007",
        city: "Chicago",
        state: "IL",
        address: "300 W Ohio St",
        zip: "60654",
        activities: []
      },
      {
        id: 1018,
        name: "Noah King",
        title: "Account Manager",
        email: "noah.king@silverlinecreative.com",
        phone: "(312) 555-2008",
        city: "Chicago",
        state: "IL",
        address: "100 E Huron St",
        zip: "60611",
        activities: []
      }
    ]
  },
  {
    id: 3,
    name: "Brightline Studio",
    website: "brightlinestudio.com",
    linkedin: "linkedin.com/company/brightlinestudio",
    city: "Austin",
    state: "TX",
    phone: "(512) 555-3000",
    email: "contact@brightlinestudio.com",
    address: "600 Congress Ave",
    zip: "78701",
    description: "Web design, UX, and content production for SaaS and tech.",
    industry: "Design",
    socials: { twitter: "@brightlinestd", facebook: "brightlinestudio", instagram: "@brightlinestudio" },
    activities: [],
    people: [
      {
        id: 1019,
        name: "Tyler Morgan",
        title: "Creative Director",
        email: "tyler.morgan@brightlinestudio.com",
        phone: "(512) 555-3001",
        city: "Austin",
        state: "TX",
        address: "201 W 5th St",
        zip: "78701",
        activities: []
      },
      {
        id: 1020,
        name: "Isabella Perez",
        title: "Senior UX Designer",
        email: "isabella.perez@brightlinestudio.com",
        phone: "(512) 555-3002",
        city: "Austin",
        state: "TX",
        address: "515 Congress Ave",
        zip: "78701",
        activities: []
      },
      {
        id: 1021,
        name: "Logan Davis",
        title: "Frontend Engineer",
        email: "logan.davis@brightlinestudio.com",
        phone: "(512) 555-3003",
        city: "Austin",
        state: "TX",
        address: "700 Lavaca St",
        zip: "78701",
        activities: []
      },
      {
        id: 1022,
        name: "Chloe Martinez",
        title: "Content Strategist",
        email: "chloe.martinez@brightlinestudio.com",
        phone: "(512) 555-3004",
        city: "Austin",
        state: "TX",
        address: "301 W 6th St",
        zip: "78701",
        activities: []
      },
      {
        id: 1023,
        name: "Jason Clark",
        title: "SEO Specialist",
        email: "jason.clark@brightlinestudio.com",
        phone: "(512) 555-3005",
        city: "Austin",
        state: "TX",
        address: "401 Congress Ave",
        zip: "78701",
        activities: []
      },
      {
        id: 1024,
        name: "Mia Thompson",
        title: "Visual Designer",
        email: "mia.thompson@brightlinestudio.com",
        phone: "(512) 555-3006",
        city: "Austin",
        state: "TX",
        address: "100 W 3rd St",
        zip: "78701",
        activities: []
      },
      {
        id: 1025,
        name: "Andrew White",
        title: "Producer",
        email: "andrew.white@brightlinestudio.com",
        phone: "(512) 555-3007",
        city: "Austin",
        state: "TX",
        address: "909 Congress Ave",
        zip: "78701",
        activities: []
      },
      {
        id: 1026,
        name: "Lily Evans",
        title: "Project Manager",
        email: "lily.evans@brightlinestudio.com",
        phone: "(512) 555-3008",
        city: "Austin",
        state: "TX",
        address: "801 W 5th St",
        zip: "78703",
        activities: []
      }
    ]
  },
  {
    id: 4,
    name: "Harbor Point Labs",
    website: "harborpointlabs.com",
    linkedin: "linkedin.com/company/harborpointlabs",
    city: "Seattle",
    state: "WA",
    phone: "(206) 555-4000",
    email: "hello@harborpointlabs.com",
    address: "1501 4th Ave",
    zip: "98101",
    description: "Data-driven experimentation, CRO, and analytics consulting.",
    industry: "Analytics",
    socials: { twitter: "@harborpointlab", facebook: "harborpointlabs", instagram: "@harborpointlabs" },
    activities: [],
    people: [
      {
        id: 1027,
        name: "Jackson Wright",
        title: "Founder",
        email: "jackson.wright@harborpointlabs.com",
        phone: "(206) 555-4001",
        city: "Seattle",
        state: "WA",
        address: "600 Pine St",
        zip: "98101",
        activities: []
      },
      {
        id: 1028,
        name: "Zoe Hill",
        title: "Lead Data Scientist",
        email: "zoe.hill@harborpointlabs.com",
        phone: "(206) 555-4002",
        city: "Seattle",
        state: "WA",
        address: "1101 4th Ave",
        zip: "98101",
        activities: []
      },
      {
        id: 1029,
        name: "Christopher Young",
        title: "Analytics Engineer",
        email: "christopher.young@harborpointlabs.com",
        phone: "(206) 555-4003",
        city: "Seattle",
        state: "WA",
        address: "1900 5th Ave",
        zip: "98101",
        activities: []
      },
      {
        id: 1030,
        name: "Samantha Price",
        title: "Optimization Strategist",
        email: "samantha.price@harborpointlabs.com",
        phone: "(206) 555-4004",
        city: "Seattle",
        state: "WA",
        address: "701 Pike St",
        zip: "98101",
        activities: []
      },
      {
        id: 1031,
        name: "Henry Baker",
        title: "Implementation Specialist",
        email: "henry.baker@harborpointlabs.com",
        phone: "(206) 555-4005",
        city: "Seattle",
        state: "WA",
        address: "1400 5th Ave",
        zip: "98101",
        activities: []
      },
      {
        id: 1032,
        name: "Layla Scott",
        title: "Project Coordinator",
        email: "layla.scott@harborpointlabs.com",
        phone: "(206) 555-4006",
        city: "Seattle",
        state: "WA",
        address: "901 5th Ave",
        zip: "98164",
        activities: []
      },
      {
        id: 1033,
        name: "Evan Rogers",
        title: "Insights Analyst",
        email: "evan.rogers@harborpointlabs.com",
        phone: "(206) 555-4007",
        city: "Seattle",
        state: "WA",
        address: "720 Olive Way",
        zip: "98101",
        activities: []
      },
      {
        id: 1034,
        name: "Madison Kelly",
        title: "Customer Success Manager",
        email: "madison.kelly@harborpointlabs.com",
        phone: "(206) 555-4008",
        city: "Seattle",
        state: "WA",
        address: "909 5th Ave",
        zip: "98164",
        activities: []
      }
    ]
  },
  {
    id: 5,
    name: "Summit Ridge Media",
    website: "summitridgemedia.com",
    linkedin: "linkedin.com/company/summitridgemedia",
    city: "Denver",
    state: "CO",
    phone: "(303) 555-5000",
    email: "team@summitridgemedia.com",
    address: "1700 Broadway",
    zip: "80290",
    description: "Paid media, search, and attribution for service brands.",
    industry: "Media",
    socials: { twitter: "@summitridgem", facebook: "summitridgemedia", instagram: "@summitridgem" },
    activities: [],
    people: [
      {
        id: 1035,
        name: "Benjamin Carter",
        title: "Media Director",
        email: "benjamin.carter@summitridgemedia.com",
        phone: "(303) 555-5001",
        city: "Denver",
        state: "CO",
        address: "999 17th St",
        zip: "80202",
        activities: []
      },
      {
        id: 1036,
        name: "Ava Richardson",
        title: "Senior Media Buyer",
        email: "ava.richardson@summitridgemedia.com",
        phone: "(303) 555-5002",
        city: "Denver",
        state: "CO",
        address: "555 17th St",
        zip: "80202",
        activities: []
      },
      {
        id: 1037,
        name: "Jack Foster",
        title: "Performance Analyst",
        email: "jack.foster@summitridgemedia.com",
        phone: "(303) 555-5003",
        city: "Denver",
        state: "CO",
        address: "1700 Lincoln St",
        zip: "80203",
        activities: []
      },
      {
        id: 1038,
        name: "Ella Gray",
        title: "Account Strategist",
        email: "ella.gray@summitridgemedia.com",
        phone: "(303) 555-5004",
        city: "Denver",
        state: "CO",
        address: "1801 California St",
        zip: "80202",
        activities: []
      },
      {
        id: 1039,
        name: "Lucas Price",
        title: "Campaign Specialist",
        email: "lucas.price@summitridgemedia.com",
        phone: "(303) 555-5005",
        city: "Denver",
        state: "CO",
        address: "1900 16th St",
        zip: "80202",
        activities: []
      },
      {
        id: 1040,
        name: "Victoria Adams",
        title: "Media Planner",
        email: "victoria.adams@summitridgemedia.com",
        phone: "(303) 555-5006",
        city: "Denver",
        state: "CO",
        address: "1400 Wewatta St",
        zip: "80202",
        activities: []
      },
      {
        id: 1041,
        name: "Owen Mitchell",
        title: "Paid Social Manager",
        email: "owen.mitchell@summitridgemedia.com",
        phone: "(303) 555-5007",
        city: "Denver",
        state: "CO",
        address: "999 18th St",
        zip: "80202",
        activities: []
      }
    ]
  },
  {
    id: 6,
    name: "Bluepeak Interactive",
    website: "bluepeakinteractive.com",
    linkedin: "linkedin.com/company/bluepeakinteractive",
    city: "San Francisco",
    state: "CA",
    phone: "(415) 555-6000",
    email: "hello@bluepeakinteractive.com",
    address: "600 Montgomery St",
    zip: "94111",
    description: "Interactive experiences and product UI for funded startups.",
    industry: "Product Design",
    socials: { twitter: "@bluepeakint", facebook: "bluepeakinteractive", instagram: "@bluepeakinteractive" },
    activities: [],
    people: [
      {
        id: 1042,
        name: "Harper Collins",
        title: "Founder & Principal",
        email: "harper.collins@bluepeakinteractive.com",
        phone: "(415) 555-6001",
        city: "San Francisco",
        state: "CA",
        address: "1 Montgomery St",
        zip: "94104",
        activities: []
      },
      {
        id: 1043,
        name: "Isaac Nguyen",
        title: "Lead Product Designer",
        email: "isaac.nguyen@bluepeakinteractive.com",
        phone: "(415) 555-6002",
        city: "San Francisco",
        state: "CA",
        address: "101 California St",
        zip: "94111",
        activities: []
      },
      {
        id: 1044,
        name: "Charlotte Brooks",
        title: "Senior Interaction Designer",
        email: "charlotte.brooks@bluepeakinteractive.com",
        phone: "(415) 555-6003",
        city: "San Francisco",
        state: "CA",
        address: "50 Fremont St",
        zip: "94105",
        activities: []
      },
      {
        id: 1045,
        name: "Eli Turner",
        title: "Design Engineer",
        email: "eli.turner@bluepeakinteractive.com",
        phone: "(415) 555-6004",
        city: "San Francisco",
        state: "CA",
        address: "345 California St",
        zip: "94104",
        activities: []
      },
      {
        id: 1046,
        name: "Stella Ward",
        title: "Client Partner",
        email: "stella.ward@bluepeakinteractive.com",
        phone: "(415) 555-6005",
        city: "San Francisco",
        state: "CA",
        address: "201 Spear St",
        zip: "94105",
        activities: []
      },
      {
        id: 1047,
        name: "Julian Ross",
        title: "UX Researcher",
        email: "julian.ross@bluepeakinteractive.com",
        phone: "(415) 555-6006",
        city: "San Francisco",
        state: "CA",
        address: "221 Main St",
        zip: "94105",
        activities: []
      },
      {
        id: 1048,
        name: "Nora Bennett",
        title: "Design Operations Manager",
        email: "nora.bennett@bluepeakinteractive.com",
        phone: "(415) 555-6007",
        city: "San Francisco",
        state: "CA",
        address: "388 Market St",
        zip: "94111",
        activities: []
      }
    ]
  },
  {
    id: 7,
    name: "Copperline Content",
    website: "copperlinecontent.com",
    linkedin: "linkedin.com/company/copperlinecontent",
    city: "Portland",
    state: "OR",
    phone: "(503) 555-7000",
    email: "contact@copperlinecontent.com",
    address: "707 SW Washington St",
    zip: "97205",
    description: "Long-form content, email, and demand gen support.",
    industry: "Content",
    socials: { twitter: "@coppercontent", facebook: "copperlinecontent", instagram: "@copperlinecontent" },
    activities: [],
    people: [
      {
        id: 1049,
        name: "Ryan Murphy",
        title: "Content Director",
        email: "ryan.murphy@copperlinecontent.com",
        phone: "(503) 555-7001",
        city: "Portland",
        state: "OR",
        address: "900 SW 5th Ave",
        zip: "97204",
        activities: []
      },
      {
        id: 1050,
        name: "Amelia Fox",
        title: "Senior Writer",
        email: "amelia.fox@copperlinecontent.com",
        phone: "(503) 555-7002",
        city: "Portland",
        state: "OR",
        address: "1000 SW Broadway",
        zip: "97205",
        activities: []
      },
      {
        id: 1051,
        name: "Dylan Carter",
        title: "Email Strategist",
        email: "dylan.carter@copperlinecontent.com",
        phone: "(503) 555-7003",
        city: "Portland",
        state: "OR",
        address: "1300 SW 6th Ave",
        zip: "97201",
        activities: []
      },
      {
        id: 1052,
        name: "Sofia Reyes",
        title: "Content Producer",
        email: "sofia.reyes@copperlinecontent.com",
        phone: "(503) 555-7004",
        city: "Portland",
        state: "OR",
        address: "700 SW 5th Ave",
        zip: "97204",
        activities: []
      },
      {
        id: 1053,
        name: "Gabriel Flores",
        title: "SEO Content Specialist",
        email: "gabriel.flores@copperlinecontent.com",
        phone: "(503) 555-7005",
        city: "Portland",
        state: "OR",
        address: "400 SW 6th Ave",
        zip: "97204",
        activities: []
      },
      {
        id: 1054,
        name: "Lena Howard",
        title: "Project Manager",
        email: "lena.howard@copperlinecontent.com",
        phone: "(503) 555-7006",
        city: "Portland",
        state: "OR",
        address: "200 SW Market St",
        zip: "97201",
        activities: []
      },
      {
        id: 1055,
        name: "Nathan Brooks",
        title: "Editor",
        email: "nathan.brooks@copperlinecontent.com",
        phone: "(503) 555-7007",
        city: "Portland",
        state: "OR",
        address: "900 SW 6th Ave",
        zip: "97204",
        activities: []
      }
    ]
  },
  {
    id: 8,
    name: "Signalpath SEO",
    website: "signalpathseo.com",
    linkedin: "linkedin.com/company/signalpathseo",
    city: "Raleigh",
    state: "NC",
    phone: "(919) 555-8000",
    email: "team@signalpathseo.com",
    address: "500 Fayetteville St",
    zip: "27601",
    description: "Technical SEO, local search, and content optimization.",
    industry: "SEO",
    socials: { twitter: "@signalpathseo", facebook: "signalpathseo", instagram: "@signalpathseo" },
    activities: [],
    people: [
      {
        id: 1056,
        name: "Olivia Ramirez",
        title: "SEO Director",
        email: "olivia.ramirez@signalpathseo.com",
        phone: "(919) 555-8001",
        city: "Raleigh",
        state: "NC",
        address: "227 Fayetteville St",
        zip: "27601",
        activities: []
      },
      {
        id: 1057,
        name: "Liam Phillips",
        title: "Technical SEO Specialist",
        email: "liam.phillips@signalpathseo.com",
        phone: "(919) 555-8002",
        city: "Raleigh",
        state: "NC",
        address: "555 S Wilmington St",
        zip: "27601",
        activities: []
      },
      {
        id: 1058,
        name: "Emma Watson",
        title: "Local SEO Manager",
        email: "emma.watson@signalpathseo.com",
        phone: "(919) 555-8003",
        city: "Raleigh",
        state: "NC",
        address: "400 S Salisbury St",
        zip: "27601",
        activities: []
      },
      {
        id: 1059,
        name: "Noah Parker",
        title: "SEO Analyst",
        email: "noah.parker@signalpathseo.com",
        phone: "(919) 555-8004",
        city: "Raleigh",
        state: "NC",
        address: "222 Glenwood Ave",
        zip: "27603",
        activities: []
      },
      {
        id: 1060,
        name: "Avery Hughes",
        title: "Content SEO Specialist",
        email: "avery.hughes@signalpathseo.com",
        phone: "(919) 555-8005",
        city: "Raleigh",
        state: "NC",
        address: "1 Exchange Plaza",
        zip: "27601",
        activities: []
      },
      {
        id: 1061,
        name: "Caleb James",
        title: "Client Success Lead",
        email: "caleb.james@signalpathseo.com",
        phone: "(919) 555-8006",
        city: "Raleigh",
        state: "NC",
        address: "201 W Martin St",
        zip: "27601",
        activities: []
      }
    ]
  },
  {
    id: 9,
    name: "Launchpad Collective",
    website: "launchpadcollective.com",
    linkedin: "linkedin.com/company/launchpadcollective",
    city: "Atlanta",
    state: "GA",
    phone: "(404) 555-9000",
    email: "hello@launchpadcollective.com",
    address: "1180 Peachtree St NE",
    zip: "30309",
    description: "Brand, web, and marketing for high-growth startups.",
    industry: "Agency",
    socials: { twitter: "@launchpadco", facebook: "launchpadcollective", instagram: "@launchpadcollective" },
    activities: [],
    people: [
      {
        id: 1062,
        name: "Mason Reed",
        title: "Managing Director",
        email: "mason.reed@launchpadcollective.com",
        phone: "(404) 555-9001",
        city: "Atlanta",
        state: "GA",
        address: "303 Peachtree St NE",
        zip: "30308",
        activities: []
      },
      {
        id: 1063,
        name: "Sienna Collins",
        title: "Brand Strategist",
        email: "sienna.collins@launchpadcollective.com",
        phone: "(404) 555-9002",
        city: "Atlanta",
        state: "GA",
        address: "191 Peachtree St NE",
        zip: "30303",
        activities: []
      },
      {
        id: 1064,
        name: "Ethan Lewis",
        title: "Senior Developer",
        email: "ethan.lewis@launchpadcollective.com",
        phone: "(404) 555-9003",
        city: "Atlanta",
        state: "GA",
        address: "600 Peachtree St NE",
        zip: "30308",
        activities: []
      },
      {
        id: 1065,
        name: "Zara Patel",
        title: "Account Manager",
        email: "zara.patel@launchpadcollective.com",
        phone: "(404) 555-9004",
        city: "Atlanta",
        state: "GA",
        address: "100 10th St NE",
        zip: "30309",
        activities: []
      },
      {
        id: 1066,
        name: "Wyatt Morgan",
        title: "UI Designer",
        email: "wyatt.morgan@launchpadcollective.com",
        phone: "(404) 555-9005",
        city: "Atlanta",
        state: "GA",
        address: "171 17th St NW",
        zip: "30363",
        activities: []
      },
      {
        id: 1067,
        name: "Lila Griffin",
        title: "Content Strategist",
        email: "lila.griffin@launchpadcollective.com",
        phone: "(404) 555-9006",
        city: "Atlanta",
        state: "GA",
        address: "950 W Peachtree St NW",
        zip: "30309",
        activities: []
      }
    ]
  },
  {
    id: 10,
    name: "Vector North Analytics",
    website: "vectornorthanalytics.com",
    linkedin: "linkedin.com/company/vectornorthanalytics",
    city: "Minneapolis",
    state: "MN",
    phone: "(612) 555-0100",
    email: "info@vectornorthanalytics.com",
    address: "50 S 6th St",
    zip: "55402",
    description: "Marketing analytics and dashboarding for B2B teams.",
    industry: "Analytics",
    socials: { twitter: "@vectornorth", facebook: "vectornorthanalytics", instagram: "@vectornorthanalytics" },
    activities: [],
    people: [
      {
        id: 1068,
        name: "Oliver Scott",
        title: "Principal Consultant",
        email: "oliver.scott@vectornorthanalytics.com",
        phone: "(612) 555-0101",
        city: "Minneapolis",
        state: "MN",
        address: "90 S 7th St",
        zip: "55402",
        activities: []
      },
      {
        id: 1069,
        name: "Avery Johnson",
        title: "Data Engineer",
        email: "avery.johnson@vectornorthanalytics.com",
        phone: "(612) 555-0102",
        city: "Minneapolis",
        state: "MN",
        address: "225 S 6th St",
        zip: "55402",
        activities: []
      },
      {
        id: 1070,
        name: "Chase Baker",
        title: "Analytics Strategist",
        email: "chase.baker@vectornorthanalytics.com",
        phone: "(612) 555-0103",
        city: "Minneapolis",
        state: "MN",
        address: "777 S 7th St",
        zip: "55415",
        activities: []
      },
      {
        id: 1071,
        name: "Paisley Parker",
        title: "BI Developer",
        email: "paisley.parker@vectornorthanalytics.com",
        phone: "(612) 555-0104",
        city: "Minneapolis",
        state: "MN",
        address: "100 Washington Ave S",
        zip: "55401",
        activities: []
      },
      {
        id: 1072,
        name: "Leo West",
        title: "Reporting Analyst",
        email: "leo.west@vectornorthanalytics.com",
        phone: "(612) 555-0105",
        city: "Minneapolis",
        state: "MN",
        address: "600 Nicollet Mall",
        zip: "55402",
        activities: []
      },
      {
        id: 1073,
        name: "Savannah Reed",
        title: "Client Analytics Manager",
        email: "savannah.reed@vectornorthanalytics.com",
        phone: "(612) 555-0106",
        city: "Minneapolis",
        state: "MN",
        address: "121 S 8th St",
        zip: "55402",
        activities: []
      }
    ]
  },
  {
    id: 11,
    name: "Riverbase Studio",
    website: "riverbasestudio.com",
    linkedin: "linkedin.com/company/riverbasestudio",
    city: "Nashville",
    state: "TN",
    phone: "(615) 555-1100",
    email: "hello@riverbasestudio.com",
    address: "401 Commerce St",
    zip: "37219",
    description: "Brand, identity, and launch campaigns for creative businesses.",
    industry: "Branding",
    socials: { twitter: "@riverbasestd", facebook: "riverbasestudio", instagram: "@riverbasestudio" },
    activities: [],
    people: [
      {
        id: 1074,
        name: "Caroline James",
        title: "Creative Director",
        email: "caroline.james@riverbasestudio.com",
        phone: "(615) 555-1101",
        city: "Nashville",
        state: "TN",
        address: "150 3rd Ave N",
        zip: "37201",
        activities: []
      },
      {
        id: 1075,
        name: "Hudson Moore",
        title: "Senior Designer",
        email: "hudson.moore@riverbasestudio.com",
        phone: "(615) 555-1102",
        city: "Nashville",
        state: "TN",
        address: "217 2nd Ave N",
        zip: "37201",
        activities: []
      },
      {
        id: 1076,
        name: "Bailey Thomas",
        title: "Brand Strategist",
        email: "bailey.thomas@riverbasestudio.com",
        phone: "(615) 555-1103",
        city: "Nashville",
        state: "TN",
        address: "600 Church St",
        zip: "37219",
        activities: []
      },
      {
        id: 1077,
        name: "Logan Hill",
        title: "Copywriter",
        email: "logan.hill@riverbasestudio.com",
        phone: "(615) 555-1104",
        city: "Nashville",
        state: "TN",
        address: "301 Broadway",
        zip: "37201",
        activities: []
      },
      {
        id: 1078,
        name: "Delilah Brooks",
        title: "Production Coordinator",
        email: "delilah.brooks@riverbasestudio.com",
        phone: "(615) 555-1105",
        city: "Nashville",
        state: "TN",
        address: "700 Church St",
        zip: "37203",
        activities: []
      },
      {
        id: 1079,
        name: "Parker James",
        title: "Junior Designer",
        email: "parker.james@riverbasestudio.com",
        phone: "(615) 555-1106",
        city: "Nashville",
        state: "TN",
        address: "100 4th Ave N",
        zip: "37219",
        activities: []
      }
    ]
  },
  {
    id: 12,
    name: "Latitude Signal",
    website: "latitudesignal.com",
    linkedin: "linkedin.com/company/latitudesignal",
    city: "Phoenix",
    state: "AZ",
    phone: "(602) 555-1200",
    email: "team@latitudesignal.com",
    address: "1 E Washington St",
    zip: "85004",
    description: "Performance marketing and funnel optimization.",
    industry: "Marketing",
    socials: { twitter: "@latitudesig", facebook: "latitudesignal", instagram: "@latitudesignal" },
    activities: [],
    people: [
      {
        id: 1080,
        name: "Adrian Torres",
        title: "Performance Director",
        email: "adrian.torres@latitudesignal.com",
        phone: "(602) 555-1201",
        city: "Phoenix",
        state: "AZ",
        address: "2 N Central Ave",
        zip: "85004",
        activities: []
      },
      {
        id: 1081,
        name: "Jade Cooper",
        title: "Digital Strategist",
        email: "jade.cooper@latitudesignal.com",
        phone: "(602) 555-1202",
        city: "Phoenix",
        state: "AZ",
        address: "100 N 1st St",
        zip: "85004",
        activities: []
      },
      {
        id: 1082,
        name: "Rowan Bailey",
        title: "Paid Search Manager",
        email: "rowan.bailey@latitudesignal.com",
        phone: "(602) 555-1203",
        city: "Phoenix",
        state: "AZ",
        address: "300 E Washington St",
        zip: "85004",
        activities: []
      },
      {
        id: 1083,
        name: "Scarlett James",
        title: "Conversion Designer",
        email: "scarlett.james@latitudesignal.com",
        phone: "(602) 555-1204",
        city: "Phoenix",
        state: "AZ",
        address: "400 N 2nd St",
        zip: "85004",
        activities: []
      },
      {
        id: 1084,
        name: "Miles Bennett",
        title: "Analytics Specialist",
        email: "miles.bennett@latitudesignal.com",
        phone: "(602) 555-1205",
        city: "Phoenix",
        state: "AZ",
        address: "50 W Jefferson St",
        zip: "85003",
        activities: []
      },
      {
        id: 1085,
        name: "Ivy Collins",
        title: "Client Success Manager",
        email: "ivy.collins@latitudesignal.com",
        phone: "(602) 555-1206",
        city: "Phoenix",
        state: "AZ",
        address: "111 W Monroe St",
        zip: "85003",
        activities: []
      }
    ]
  },
  {
    id: 13,
    name: "Anchorline Systems",
    website: "anchorlinesystems.com",
    linkedin: "linkedin.com/company/anchorlinesystems",
    city: "Boston",
    state: "MA",
    phone: "(617) 555-1300",
    email: "hello@anchorlinesystems.com",
    address: "100 Summer St",
    zip: "02110",
    description: "Implementation and integration support for CRM and marketing ops.",
    industry: "Systems Integration",
    socials: { twitter: "@anchorlinesys", facebook: "anchorlinesystems", instagram: "@anchorlinesystems" },
    activities: [],
    people: [
      {
        id: 1086,
        name: "Jordan Mitchell",
        title: "Implementation Lead",
        email: "jordan.mitchell@anchorlinesystems.com",
        phone: "(617) 555-1301",
        city: "Boston",
        state: "MA",
        address: "200 High St",
        zip: "02110",
        activities: []
      },
      {
        id: 1087,
        name: "Taylor Reed",
        title: "Solutions Architect",
        email: "taylor.reed@anchorlinesystems.com",
        phone: "(617) 555-1302",
        city: "Boston",
        state: "MA",
        address: "60 State St",
        zip: "02109",
        activities: []
      },
      {
        id: 1088,
        name: "Morgan Blake",
        title: "Integration Engineer",
        email: "morgan.blake@anchorlinesystems.com",
        phone: "(617) 555-1303",
        city: "Boston",
        state: "MA",
        address: "1 Federal St",
        zip: "02110",
        activities: []
      },
      {
        id: 1089,
        name: "Sydney Fox",
        title: "Technical PM",
        email: "sydney.fox@anchorlinesystems.com",
        phone: "(617) 555-1304",
        city: "Boston",
        state: "MA",
        address: "99 High St",
        zip: "02110",
        activities: []
      },
      {
        id: 1090,
        name: "Elliot James",
        title: "Support Engineer",
        email: "elliot.james@anchorlinesystems.com",
        phone: "(617) 555-1305",
        city: "Boston",
        state: "MA",
        address: "10 Summer St",
        zip: "02111",
        activities: []
      }
    ]
  },
  {
    id: 14,
    name: "Radius Signal Co.",
    website: "radiussignal.co",
    linkedin: "linkedin.com/company/radiussignal",
    city: "Columbus",
    state: "OH",
    phone: "(614) 555-1400",
    email: "contact@radiussignal.co",
    address: "50 W Broad St",
    zip: "43215",
    description: "Regional marketing, PR, and communications support.",
    industry: "PR & Comms",
    socials: { twitter: "@radiussignal", facebook: "radiussignal", instagram: "@radiussignal" },
    activities: [],
    people: [
      {
        id: 1091,
        name: "Reese Campbell",
        title: "Communications Director",
        email: "reese.campbell@radiussignal.co",
        phone: "(614) 555-1401",
        city: "Columbus",
        state: "OH",
        address: "100 E Broad St",
        zip: "43215",
        activities: []
      },
      {
        id: 1092,
        name: "Alexis Morgan",
        title: "Media Relations Manager",
        email: "alexis.morgan@radiussignal.co",
        phone: "(614) 555-1402",
        city: "Columbus",
        state: "OH",
        address: "1 Nationwide Blvd",
        zip: "43215",
        activities: []
      },
      {
        id: 1093,
        name: "Grayson Lee",
        title: "PR Strategist",
        email: "grayson.lee@radiussignal.co",
        phone: "(614) 555-1403",
        city: "Columbus",
        state: "OH",
        address: "400 N High St",
        zip: "43215",
        activities: []
      },
      {
        id: 1094,
        name: "Jordan Phillips",
        title: "Event Manager",
        email: "jordan.phillips@radiussignal.co",
        phone: "(614) 555-1404",
        city: "Columbus",
        state: "OH",
        address: "300 Marconi Blvd",
        zip: "43215",
        activities: []
      },
      {
        id: 1095,
        name: "Taylor Brooks",
        title: "Account Coordinator",
        email: "taylor.brooks@radiussignal.co",
        phone: "(614) 555-1405",
        city: "Columbus",
        state: "OH",
        address: "20 E Broad St",
        zip: "43215",
        activities: []
      }
    ]
  },
  {
    id: 15,
    name: "Signalcrest Partners",
    website: "signalcrestpartners.com",
    linkedin: "linkedin.com/company/signalcrestpartners",
    city: "Dallas",
    state: "TX",
    phone: "(214) 555-1500",
    email: "hello@signalcrestpartners.com",
    address: "2001 Ross Ave",
    zip: "75201",
    description: "Operations and growth advisory for digital agencies.",
    industry: "Consulting",
    socials: { twitter: "@signalcrest", facebook: "signalcrestpartners", instagram: "@signalcrestpartners" },
    activities: [],
    people: [
      {
        id: 1096,
        name: "James Carter",
        title: "Managing Partner",
        email: "james.carter@signalcrestpartners.com",
        phone: "(214) 555-1501",
        city: "Dallas",
        state: "TX",
        address: "2100 Ross Ave",
        zip: "75201",
        activities: []
      },
      {
        id: 1097,
        name: "Madison Lee",
        title: "Senior Consultant",
        email: "madison.lee@signalcrestpartners.com",
        phone: "(214) 555-1502",
        city: "Dallas",
        state: "TX",
        address: "1700 Pacific Ave",
        zip: "75201",
        activities: []
      },
      {
        id: 1098,
        name: "Ethan Clark",
        title: "Operations Strategist",
        email: "ethan.clark@signalcrestpartners.com",
        phone: "(214) 555-1503",
        city: "Dallas",
        state: "TX",
        address: "2200 Ross Ave",
        zip: "75201",
        activities: []
      },
      {
        id: 1099,
        name: "Sophia Martinez",
        title: "Financial Analyst",
        email: "sophia.martinez@signalcrestpartners.com",
        phone: "(214) 555-1504",
        city: "Dallas",
        state: "TX",
        address: "1900 Pearl St",
        zip: "75201",
        activities: []
      },
      {
        id: 1100,
        name: "Logan Young",
        title: "Engagement Manager",
        email: "logan.young@signalcrestpartners.com",
        phone: "(214) 555-1505",
        city: "Dallas",
        state: "TX",
        address: "1717 McKinney Ave",
        zip: "75202",
        activities: []
      }
    ]
  }
];

    
    function getStoplightClasses(percent) {
        if (percent <= 85) return { text: 'text-green-600 dark:text-green-400', bg: 'bg-green-500', bgWeak: 'bg-green-100 dark:bg-green-500/20' };
        if (percent <= 100) return { text: 'text-yellow-600 dark:text-yellow-400', bg: 'bg-yellow-500', bgWeak: 'bg-yellow-100 dark:bg-yellow-500/20' };
        return { text: 'text-red-600 dark:text-red-400', bg: 'bg-red-500', bgWeak: 'bg-red-100 dark:bg-red-500/20' };
    }

    function renderMeter(label, percent) {
        const colorClasses = getStoplightClasses(percent);
        const displayPercent = isFinite(percent) ? percent.toFixed(0) : 0;
        const meterPercent = isFinite(percent) ? Math.min(percent, 100) : 0;
        return `
            <div class="space-y-1 w-full">
                <div class="flex justify-between items-baseline" ${label ? '' : 'style="display:none;"'}>
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300 truncate pr-2">${label}</span>
                    <span class="text-sm font-semibold ${colorClasses.text}">${displayPercent}%</span>
                </div>
                <div class="meter-bar bg-gray-200 dark:bg-gray-700 w-full">
                    <div class="meter-bar-inner ${colorClasses.bg}" style="width: ${meterPercent}%;"></div>
                </div>
            </div>
        `;
    }
    
    function renderStackedPerformance(actual, est, timelinePct) {
        const validEst = est || 1;
        const safeActual = actual || 0;
        const effortPct = (safeActual / validEst) * 100;
        const safeEffortPct = isNaN(effortPct) ? 0 : effortPct;
        const safeTimelinePct = isNaN(timelinePct) ? 0 : timelinePct;
        const getBarColor = (p) => {
            if (p > 100) return 'bg-red-500';
            if (p > 85.001) return 'bg-yellow-500';
            return 'bg-green-500';
        };
        return `
            <div class="flex flex-col w-48 gap-1">
                <div class="flex justify-between items-baseline text-xs mb-0.5">
                    <span class="text-gray-500 dark:text-gray-400 font-mono">${safeActual.toFixed(0)}/${validEst}</span>
                    <span class="font-bold text-gray-700 dark:text-gray-300">${safeEffortPct.toFixed(0)}%</span>
                </div>
                <div class="flex items-center gap-2" data-tooltip="Actual vs estimated hours.">
                    <div class="flex-1 h-[8px] bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="${getBarColor(safeEffortPct)} h-full rounded-full" style="width: ${Math.min(safeEffortPct, 100)}%" aria-label="LOE ${safeEffortPct.toFixed(0)} percent"></div>
                    </div>
                    <span class="text-xs font-medium w-8 text-right text-gray-600 dark:text-gray-400">${safeEffortPct.toFixed(0)}%</span>
                </div>
                <div class="flex items-center gap-2" data-tooltip="Elapsed vs planned timeline.">
                    <div class="flex-1 h-[8px] bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="${getBarColor(safeTimelinePct)} h-full rounded-full" style="width: ${Math.min(safeTimelinePct, 100)}%" aria-label="Timeline ${safeTimelinePct.toFixed(0)} percent"></div>
                    </div>
                    <span class="text-xs font-medium w-8 text-right text-gray-600 dark:text-gray-400">${safeTimelinePct.toFixed(0)}%</span>
                </div>
            </div>
        `;
    }
    
    let REPORT_FILTER = 'all';

    function renderAppShell(hash) {
      return `
        <div id="app-shell" class="drawer-closed bg-white dark:bg-black">
          ${renderMobileHeader()}
          ${renderTopBar()}
          ${renderSidebar(hash)}
          ${renderMainContent(hash)}
          ${renderMobileBottomNav(hash)}
          ${renderMobileMenu(hash)}
          <div id="drawer-container"></div>
        </div>
      `;
    }
    
    const LOGO_ASSETS = {
        dark: { idle: 'https://hellonetnet.com/wp-content/uploads/2024/12/logo-white.svg', active: 'https://hellonetnet.com/wp-content/uploads/2024/12/logo-outline.svg' },
        light: { idle: 'https://hellonetnet.com/wp-content/uploads/2024/12/logo-standard.svg', active: 'https://hellonetnet.com/wp-content/uploads/2025/11/logo-outline-black.svg' }
    };

    function renderMobileHeader() {
        return `
          <div id="mobile-header" class="mobile-header md:hidden bg-white dark:bg-slate-900 shadow-sm">
             <img id="mobile-header-logo" src="${LOGO_ASSETS.dark.idle}" alt="Net Net" class="h-6 w-auto" />
          </div>
        `;
    }

    function renderMobileBottomNav(hash) {
        const meIcon = 'https://hellonetnet.com/wp-content/uploads/2025/11/Me-Active-white.svg';
        const timeIcon = 'https://hellonetnet.com/wp-content/uploads/2025/11/Time-Active-white.svg';
        const chatIcon = 'https://hellonetnet.com/wp-content/uploads/2025/11/Chat-Active-white.svg';
        return `
          <div id="mobileBottomNav" class="mobile-bottom-nav md:hidden">
             <button onclick="navigate('#/app/me/tasks')" class="flex items-center justify-center w-12 h-12 rounded-full active:bg-white/10">
                 <img src="${meIcon}" alt="Me" class="w-7 h-7" />
             </button>
             <button onclick="navigate('#/app/net-net-bot')" class="flex items-center justify-center w-12 h-12 rounded-full active:bg-white/10">
                 <img src="https://hellonetnet.com/wp-content/uploads/2025/11/AI-Active-white.svg" alt="Net Net Bot" class="w-7 h-7" />
             </button>
             <button id="mobileTimerBtn" class="flex items-center justify-center w-12 h-12 rounded-full active:bg-white/10">
                 <img id="mobileTimerIcon" src="${timeIcon}" alt="Timer" class="w-7 h-7" />
             </button>
             <button onclick="navigate('#/app/chat')" class="flex items-center justify-center w-12 h-12 rounded-full active:bg-white/10">
                 <img src="${chatIcon}" alt="Chat" class="w-7 h-7" />
             </button>
             <button id="mobileMenuBtn" class="flex items-center justify-center w-12 h-12 rounded-full active:bg-white/10">
                 <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
             </button>
          </div>
        `;
    }

    function renderMobileMenu(hash) {
        const activeWS = getActiveWorkspace();
        return `
          <div id="mobileMenuOverlay" class="mobile-menu-overlay md:hidden bg-white dark:bg-[#0F172A]">
             <div class="p-6 flex-1 overflow-y-auto">
                <div class="flex justify-end mb-4">
                   <button id="mobileMenuCloseBtn" class="p-2 text-gray-500 dark:text-gray-400">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                   </button>
                </div>
                <nav class="space-y-6 mb-8">
                   ${SIDEBAR_LINKS.map(item => {
                      const iconSrc = ICONS[item.key].light.idle;
                      const isActive = item.path === hash || (item.key === 'me' && hash.startsWith('#/app/me'));
                      const subMenu = (item.subs && isActive) ? `
                          <div class="ml-10 mt-1 flex flex-col gap-3 text-sm text-slate-600 dark:text-slate-300 border-l-2 border-gray-200 dark:border-gray-700 pl-4">
                              ${item.subs.map(sub => `<button type="button" class="text-left hover:text-slate-900 dark:hover:text-white mobile-menu-link ${hash.startsWith(sub.path) ? 'text-netnet-purple font-medium dark:text-white' : ''}" data-path="${sub.path}">${sub.name}</button>`).join('')}
                          </div>` : '';
                      return `
                      <button class="mobile-menu-link w-full flex items-center gap-4 text-left" data-path="${item.path}">
                          <img src="${iconSrc}" class="w-6 h-6" data-mobile-menu-icon="${item.key}">
                          <span class="text-lg font-semibold text-gray-900 dark:text-white">${item.name}</span>
                      </button>${subMenu}`;
                   }).join('')}
                </nav>
                <div class="w-full h-px bg-gray-200 dark:bg-white/10 mb-8"></div>
                <nav class="space-y-6">
                   <button class="mobile-menu-link w-full flex items-center gap-4 text-left" data-path="#/app/settings">
                       <div class="w-6 h-6 text-gray-500 dark:text-gray-400">${APP_ICONS.settings}</div>
                       <span class="text-base font-medium text-gray-700 dark:text-gray-300">Settings</span>
                   </button>
                   <button class="mobile-menu-link w-full flex items-center gap-4 text-left" data-path="#/app/profile">
                       <div class="w-6 h-6 text-gray-500 dark:text-gray-400">${APP_ICONS.avatar}</div>
                       <span class="text-base font-medium text-gray-700 dark:text-gray-300">Profile</span>
                   </button>
                   <div class="flex items-center justify-between">
                       <div class="flex items-center gap-4">
                           <div class="w-6 h-6 text-gray-500 dark:text-gray-400 flex justify-center"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg></div>
                           <span class="text-base font-medium text-gray-700 dark:text-gray-300">Appearance</span>
                       </div>
                       <button id="mobileThemeToggle" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 dark:bg-netnet-purple transition-colors">
                           <span class="translate-x-1 dark:translate-x-6 inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span>
                       </button>
                   </div>
                   <button class="w-full flex items-center gap-4 text-left">
                       <div class="w-6 h-6 text-gray-500 dark:text-gray-400 flex justify-center"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 1 1 5.82 1c0 2-3 2-3 4"/><line x1="12" y1="17" x2="12" y2="17"/></svg></div>
                       <span class="text-base font-medium text-gray-700 dark:text-gray-300">Help</span>
                   </button>
                   <button class="w-full flex items-center gap-4 text-left">
                       <div class="w-6 h-6 text-gray-500 dark:text-gray-400 flex justify-center"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8a6 6 0 10-12 0c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg></div>
                       <span class="text-base font-medium text-gray-700 dark:text-gray-300">Notifications</span>
                   </button>
                   <button id="mobileWorkspaceMenuButton" type="button" class="w-full flex items-center gap-4 text-left">
                      <span class="inline-flex items-center justify-center rounded-full bg-white shadow-sm border border-gray-200 dark:border-gray-600" style="width:28px;height:28px;">
                        <img id="mobileWorkspaceMenuIcon" src="${activeWS.icon}" alt="${activeWS.name}" class="h-5 w-5 object-contain"/>
                      </span>
                      <span class="text-base font-medium text-gray-700 dark:text-gray-300">Workspace</span>
                   </button>
                   <button id="mobileLogoutBtn" class="w-full flex items-center gap-4 text-left">
                       <div class="w-6 h-6 text-gray-500 dark:text-gray-400">${APP_ICONS.logout}</div>
                       <span class="text-base font-medium text-gray-700 dark:text-gray-300">Log out</span>
                   </button>
                </nav>
             </div>
          </div>
        `;
    }

    function renderTopBar() {
      return `
        <header id="app-top-bar" class="hidden md:flex bg-netnet-purple items-center justify-between px-4">
          <a href="#/app/me/tasks" id="top-bar-logo-link" class="flex-shrink-0">
            <img src="https://hellonetnet.com/wp-content/uploads/2024/12/logo-white.svg" id="top-bar-logo-img" alt="Net Net" class="h-[30px] w-auto ml-3" />
          </a>
          <div id="workspaceTabs" class="hidden lg:flex items-end gap-2 ml-10 overflow-x-auto scrollbar-none self-stretch h-full"></div>
          <div class="ml-auto flex items-center gap-4 pr-3">
            <button id="timerBtn" class="relative inline-flex items-center justify-center h-9 w-9 rounded-full hover:bg-white/15 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-transparent focus:ring-white/40">
              <img id="timerIcon" alt="Timer" class="h-5 w-5 select-none pointer-events-none" />
              <span class="flyout-label bg-gray-800 text-white dark:bg-gray-100 dark:text-black">Time</span>
            </button>
            <span class="h-5 w-px bg-white/25"></span>
            <button id="helpBtn" class="relative flex items-center justify-center h-9 w-9 rounded-full text-white/90 hover:text-white hover:bg-white/15" aria-label="Help">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 1 1 5.82 1c0 2-3 2-3 4"/><line x1="12" y1="17" x2="12" y2="17"/></svg>
              <span class="flyout-label bg-gray-800 text-white dark:bg-gray-100 dark:text-black">Get Help</span>
            </button>
            <button id="notifBtn" class="relative flex items-center justify-center h-9 w-9 rounded-full text-white/90 hover:text-white hover:bg-white/15" aria-label="Notifications">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M18 8a6 6 0 10-12 0c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
              <span class="flyout-label bg-gray-800 text-white dark:bg-gray-100 dark:text-black">Notifications</span>
            </button>
            <button id="appThemeBtn" type="button" class="flex items-center gap-2 rounded-md border px-3 py-1.5 text-sm border-white/25 text-white/90 hover:bg-white/15 hover:text-white">
              <span class="inline-flex items-center dark:hidden"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="4"></circle><path d="M12 1v3M12 20v3M4.22 4.22l2.12 2.12M17.66 17.66l2.12 2.12M1 12h3M20 12h3M4.22 19.78l2.12-2.12M17.66 6.34l2.12-2.12"/></svg><span class="ml-1.5">Light</span></span>
              <span class="hidden dark:inline-flex items-center"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg><span class="ml-1.5">Dark</span></span>
            </button>
          </div>
        </header>
      `;
    }

    function renderSidebar(hash) {
        return `
            <aside id="app-sidebar" class="hidden md:flex bg-[#0F172A] dark:bg-[#0F172A] flex-col justify-between p-2 overflow-y-auto">
                <nav class="space-y-2">
                    ${SIDEBAR_LINKS.map(item => {
                        const iconSet = ICONS[item.key];
                        if (!iconSet) return '';
                        const imgClass = item.key === 'me' ? 'h-5 w-5' : 'h-6 w-6';
                        const isActive = item.path === hash || (item.key === 'me' && hash.startsWith('#/app/me'));
                        const subMenu = (item.subs && isActive) ? `
                            <div class="mt-1 ml-4 hidden lg:flex flex-col gap-1 text-sm text-slate-600 dark:text-slate-300">
                                ${item.subs.map(sub => `<a href="${sub.path}" class="flex items-center gap-2 hover:text-slate-900 dark:hover:text-white p-1 pl-2 rounded transition-colors ${hash.startsWith(sub.path) ? 'text-netnet-purple font-medium dark:text-white' : ''}"><span>${sub.name}</span></a>`).join('')}
                            </div>` : '';
                        return `
                        <div class="flex flex-col">
                            <a href="${item.path}" class="relative flex items-center justify-center lg:justify-start lg:px-4 h-12 w-12 lg:w-auto rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors" aria-label="${item.name}">
                                <img data-icon="${item.key}" alt="${item.name}" class="${imgClass} flex-shrink-0" data-light-idle="${iconSet.light.idle}" data-light-active="${iconSet.light.active}" data-dark-idle="${iconSet.dark.idle}" data-dark-active="${iconSet.dark.active}"/>
                                <span class="flyout-label lg:ml-3 bg-gray-800 text-white dark:bg-gray-100 dark:text-black lg:bg-transparent lg:text-gray-700 lg:dark:text-gray-200 lg:static lg:opacity-100 lg:transform-none lg:p-0 lg:pointer-events-auto">${item.name}</span>
                            </a>${subMenu}
                        </div>`
                    }).join('')}
                </nav>
                <nav class="space-y-2">
                    <a href="#/app/settings" class="relative flex items-center justify-center lg:justify-start lg:px-4 h-12 w-12 lg:w-auto rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-800">
                        <span class="flex-shrink-0">${APP_ICONS.settings}</span>
                        <span class="flyout-label lg:ml-3 bg-gray-800 text-white dark:bg-gray-100 dark:text-black lg:bg-transparent lg:text-gray-700 lg:dark:text-gray-200 lg:static lg:opacity-100 lg:transform-none lg:p-0 lg:pointer-events-auto">Settings</span>
                    </a>
                    <a href="#/app/profile" class="relative flex items-center justify-center lg:justify-start lg:px-4 h-12 w-12 lg:w-auto rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-800">
                        <span class="flex-shrink-0">${APP_ICONS.avatar}</span>
                        <span class="flyout-label lg:ml-3 bg-gray-800 text-white dark:bg-gray-100 dark:text-black lg:bg-transparent lg:text-gray-700 lg:dark:text-gray-200 lg:static lg:opacity-100 lg:transform-none lg:p-0 lg:pointer-events-auto">Profile</span>
                    </a>
                    <button id="workspaceSwitcherButton" type="button" class="relative flex items-center justify-center lg:justify-start lg:px-4 h-12 w-12 lg:w-auto rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-800 w-full transition-colors">
                        <img id="workspaceSwitcherIcon" src="" alt="Workspace" class="h-6 w-6 flex-shrink-0 rounded-full object-contain"/>
                        <span class="flyout-label lg:ml-3 bg-gray-800 text-white dark:bg-gray-100 dark:text-black lg:bg-transparent lg:text-gray-700 lg:dark:text-gray-200 lg:static lg:opacity-100 lg:transform-none lg:p-0 lg:pointer-events-auto">Workspace</span>
                    </button>
                    <a href="#/auth/login" id="logout-btn" class="relative flex items-center justify-center lg:justify-start lg:px-4 h-12 w-12 lg:w-auto rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-800">
                        <span class="flex-shrink-0">${APP_ICONS.logout}</span>
                        <span class="flyout-label lg:ml-3 bg-gray-800 text-white dark:bg-gray-100 dark:text-black lg:bg-transparent lg:text-gray-700 lg:dark:text-gray-200 lg:static lg:opacity-100 lg:transform-none lg:p-0 lg:pointer-events-auto">Log out</span>
                    </a>
                </nav>
            </aside>
        `;
    }
    
    function getTimelinePercent(start, end) {
        const s = new Date(start).getTime();
        const e = new Date(end).getTime();
        const n = new Date().getTime();
        if (isNaN(s) || isNaN(e)) return 0;
        if (e <= s) return 100;
        const p = ((n - s) / (e - s)) * 100;
        return isNaN(p) ? 0 : Math.max(0, p);
    }
    
    function renderMainContent(hash) {
      const currentItem = SIDEBAR_LINKS.find(item => hash.startsWith(item.path) || (item.subs && item.subs.some(s => hash.startsWith(s.path)))) || { name: 'App', path: '' };
      let contentHtml;
      const companyMatch = hash.match(/^#\/app\/contacts\/company\/(\d+)$/);
      const personMatch = hash.match(/^#\/app\/contacts\/person\/(\d+)$/);

      if (hash === '#/app/me' || hash === '#/app/me/' || hash.startsWith('#/app/me/tasks')) {
          contentHtml = renderMeEmptyState('You do not have any tasks assigned', 'Once tasks are assigned, they will appear here', '+ New Task');
      } else if (hash.startsWith('#/app/me/time')) {
          contentHtml = `
          <section class="relative mx-auto max-w-2xl">
            <div class="mx-auto w-full rounded-2xl border bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm shadow-xl border-black/10 dark:border-white/10 px-6 py-8 md:px-8 md:py-10 text-center">
              <button type="button" class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full ring-1 ring-black/10 dark:ring-white/10 bg-white dark:bg-slate-700 shadow-inner" aria-label="Me icon" onmouseenter="meIconSwap(true)" onmouseleave="meIconSwap(false)" onclick="meIconSwap(true)">
                <img id="meFeaturedIcon" alt="Me" class="h-7 w-7 select-none pointer-events-none">
              </button>
              <h2 class="text-xl md:text-2xl font-semibold text-slate-900 dark:text-white">You Don't Have Any Time Logged yet</h2>
              <p class="mt-2 text-sm md:text-base text-slate-600 dark:text-slate-300">Once you start logging time, it will appear here in your personal timesheets.</p>
              <div class="mt-6 flex items-center justify-center gap-3">
                <button type="button" id="openDrawerBtn" class="inline-flex h-10 items-center justify-center rounded-md border px-4 text-sm font-medium border-slate-300 bg-white text-slate-700 hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:hover:bg-slate-700" onclick="openDrawer()">Open Context Panel</button>
                <button type="button" class="inline-flex h-10 items-center justify-center rounded-md px-4 text-sm font-semibold text-white transition-colors" style="background:#711FFF;" onmouseover="this.style.background='#6020df';" onmouseout="this.style.background='#711FFF';">+ New Time Entry</button>
              </div>
            </div>
          </section>`;
      } else if (hash.startsWith('#/app/me/performance')) {
          contentHtml = `
          <section class="relative mx-auto max-w-2xl">
            <div class="mx-auto w-full rounded-2xl border bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm shadow-xl border-black/10 dark:border-white/10 px-6 py-8 md:px-8 md:py-10 text-center">
              <button type="button" class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full ring-1 ring-black/10 dark:ring-white/10 bg-white dark:bg-slate-700 shadow-inner" aria-label="Me icon" onmouseenter="meIconSwap(true)" onmouseleave="meIconSwap(false)" onclick="meIconSwap(true)">
                <img id="meFeaturedIcon" alt="Me" class="h-7 w-7 select-none pointer-events-none">
              </button>
              <h2 class="text-xl md:text-2xl font-semibold text-slate-900 dark:text-white">You Don't Have Any performance KPI's Yet</h2>
              <p class="mt-2 text-sm md:text-base text-slate-600 dark:text-slate-300">As you complete work and log time, your personal performance KPI’s will appear here.</p>
              <div class="mt-6 flex items-center justify-center gap-3">
                <button type="button" id="openDrawerBtn" class="inline-flex h-10 items-center justify-center rounded-md border px-4 text-sm font-medium border-slate-300 bg-white text-slate-700 hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:hover:bg-slate-700" onclick="openDrawer()">Open Context Panel</button>
                <button type="button" class="inline-flex h-10 items-center justify-center rounded-md px-4 text-sm font-semibold text-white transition-colors" style="background:#711FFF;" onmouseover="this.style.background='#6020df';" onmouseout="this.style.background='#711FFF';">+ View Performance Tips</button>
              </div>
            </div>
          </section>`;
      } else if (currentItem.path === '#/app/net-net-bot') {
        const isDark = __isDark();
        const iconSrc = isDark ? BOT_ICONS.dark.active : BOT_ICONS.light.active;
        contentHtml = `
          <div class="flex flex-col h-full relative bg-transparent">
            <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 shrink-0">
                <div class="flex items-center gap-3">
                   <div class="w-8 h-8 rounded-full bg-netnet-purple/10 flex items-center justify-center"><img src="${iconSrc}" class="w-5 h-5 object-contain" /></div>
                   <h2 class="font-semibold text-gray-900 dark:text-white">Net Net Bot</h2>
                </div>
                <div class="flex items-center gap-2">
                   <button id="new-chat-btn" class="px-3 py-1.5 text-sm font-medium text-netnet-purple dark:text-white bg-netnet-purple/10 dark:bg-white/10 rounded-md hover:bg-netnet-purple/20 dark:hover:bg-white/20 transition-colors">+ New Chat</button>
                   <button onclick="openDrawer('chat-history')" class="px-3 py-1.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors">Chat History</button>
                </div>
            </div>
            <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-[#0B1120]">
               <div class="flex gap-3">
                  <div class="w-8 h-8 rounded-full bg-white dark:bg-gray-800 shadow-sm flex items-center justify-center shrink-0"><img src="${iconSrc}" class="w-5 h-5 object-contain"></div>
                  <div class="flex flex-col gap-2 max-w-[85%]"><div class="bg-[#E1D6F7] dark:bg-gray-800 p-3 rounded-2xl rounded-tl-none shadow-sm text-gray-800 dark:text-gray-200 text-sm">Hello! I can help you with tasks, time tracking, or performance insights. What's on your mind?</div></div>
               </div>
            </div>
            <div class="p-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 shrink-0">
               <div class="relative flex items-center gap-2 bg-gray-100 dark:bg-gray-800 rounded-3xl px-3 py-2.5">
                  <button class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-full transition-colors h-10 w-10 flex items-center justify-center" onclick="showToast('File upload simulated')">${CHAT_UI_ICONS.clip}</button>
                  <textarea id="chat-input" rows="1" class="flex-1 bg-transparent border-none focus:ring-0 focus:outline-none text-gray-900 dark:text-white placeholder-gray-500 text-sm leading-5 resize-none py-2 max-h-[200px] overflow-y-auto min-h-[44px]" placeholder="Ask the AI Bot about tasks, time, or performance..."></textarea>
                  <button class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-full transition-colors h-10 w-10 flex items-center justify-center" onclick="showToast('Voice input simulated')">${CHAT_UI_ICONS.mic}</button>
                  <button id="chat-send-btn" disabled class="p-2 bg-gray-300 dark:bg-gray-700 text-white rounded-full disabled:opacity-50 enabled:bg-netnet-purple transition-all h-10 w-10 flex items-center justify-center">${CHAT_UI_ICONS.send}</button>
               </div>
            </div>
          </div>`;
      } else if (companyMatch) {
         const id = parseInt(companyMatch[1]);
         contentHtml = `<div id="profile-container" class="h-full overflow-y-auto" data-type="company" data-id="${id}"></div>`;
      } else if (personMatch) {
         const id = parseInt(personMatch[1]);
         contentHtml = `<div id="profile-container" class="h-full overflow-y-auto" data-type="person" data-id="${id}"></div>`;
      } else if (currentItem.path === '#/app/contacts') {
        const cities = [...new Set(mockContactsData.map(c => c.city))];
        const states = [...new Set(mockContactsData.map(c => c.state))];
        const titles = [...new Set(mockContactsData.flatMap(c => c.people.map(p => p.title)))];
        contentHtml = `
          <div class="flex flex-col h-full relative">
            <div class="sticky top-0 z-20 flex flex-col md:flex-row items-center justify-between px-4 py-3 gap-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 shrink-0">
                <div class="flex flex-col md:flex-row items-center gap-3 w-full md:w-auto flex-1">
                   <div class="relative w-full md:w-64">
                      <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-400"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div>
                      <input type="text" id="contact-search" placeholder="Search companies or people..." class="w-full h-10 pl-10 pr-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-netnet-purple focus:border-transparent">
                   </div>
                   <select id="filter-city" class="w-full md:w-40 h-10 px-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm text-gray-700 dark:text-gray-300 focus:ring-2 focus:ring-netnet-purple"> <option value="all">All Cities</option> ${cities.map(c => `<option value="${c}">${c}</option>`).join('')} </select>
                   <select id="filter-state" class="w-full md:w-32 h-10 px-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm text-gray-700 dark:text-gray-300 focus:ring-2 focus:ring-netnet-purple"> <option value="all">All States</option> ${states.map(s => `<option value="${s}">${s}</option>`).join('')} </select>
                   <select id="filter-title" class="w-full md:w-40 h-10 px-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm text-gray-700 dark:text-gray-300 focus:ring-2 focus:ring-netnet-purple"> <option value="all">All Titles</option> ${titles.map(t => `<option value="${t}">${t}</option>`).join('')} </select>
                </div>
                <button onclick="showToast('New Contact feature coming soon')" class="w-full md:w-auto px-4 py-2 bg-netnet-purple text-white font-medium rounded-lg hover:bg-[#6020df] transition-colors flex items-center justify-center gap-2"><span>+ New Contact</span></button>
            </div>
            <div class="flex-1 overflow-y-auto">
               <table class="w-full text-left border-collapse">
                  <thead class="bg-gray-50 dark:bg-gray-800/80 sticky top-0 z-10 text-xs uppercase text-gray-500 dark:text-gray-400 font-semibold backdrop-blur-sm">
                     <tr> <th class="px-6 py-3 border-b border-gray-200 dark:border-gray-700 w-10"></th> <th class="px-6 py-3 border-b border-gray-200 dark:border-gray-700">Company Name</th> <th class="px-6 py-3 border-b border-gray-200 dark:border-gray-700 hidden md:table-cell">Website</th> <th class="px-6 py-3 border-b border-gray-200 dark:border-gray-700">City</th> <th class="px-6 py-3 border-b border-gray-200 dark:border-gray-700">State</th> </tr>
                  </thead>
                  <tbody id="contacts-table-body" class="divide-y divide-gray-100 dark:divide-gray-800"></tbody>
               </table>
            </div>
          </div>`;
      } else if (currentItem.path === '#/app/sales') {
        contentHtml = `
          <section class="relative mx-auto max-w-2xl">
            <div class="mx-auto w-full rounded-2xl border bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm shadow-xl border-black/10 dark:border-white/10 px-6 py-8 md:px-8 md:py-10 text-center">
              <button type="button" class="me-featured-icon mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full ring-1 ring-black/10 dark:ring-white/10 bg-white dark:bg-slate-700 shadow-inner" aria-label="Sales icon" onmouseenter="salesIconSwap(true)" onmouseleave="salesIconSwap(false)" onclick="salesIconSwap(true)">
                <img id="salesFeaturedIcon" alt="Sales" class="h-7 w-7 select-none pointer-events-none">
              </button>
              <h2 class="text-xl md:text-2xl font-semibold text-slate-900 dark:text-white">No sales found</h2>
              <p class="mt-2 text-sm md:text-base text-slate-600 dark:text-slate-300">Once sales opportunities are created, they will appear here</p>
              <div class="mt-6 flex items-center justify-center gap-3">
                <button type="button" id="openDrawerBtn" class="inline-flex h-10 items-center justify-center rounded-md border px-4 text-sm font-medium border-slate-300 bg-white text-slate-700 hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:hover:bg-slate-700">Open Context Panel</button>
                <button type="button" class="inline-flex h-10 items-center justify-center rounded-md px-4 text-sm font-semibold text-white transition-colors" style="background:#711FFF;" onmouseover="this.style.background='#6020df';" onmouseout="this.style.background='#711FFF';">+ New Sales</button>
              </div>
            </div>
          </section>`;
      } else if (currentItem.path === '#/app/jobs') {
        contentHtml = `
          <section class="relative mx-auto max-w-2xl">
            <div class="mx-auto w-full rounded-2xl border bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm shadow-xl border-black/10 dark:border-white/10 px-6 py-8 md:px-8 md:py-10 text-center">
              <button type="button" class="me-featured-icon mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full ring-1 ring-black/10 dark:ring-white/10 bg-white dark:bg-slate-700 shadow-inner" aria-label="Jobs icon" onmouseenter="jobsIconSwap(true)" onmouseleave="jobsIconSwap(false)" onclick="jobsIconSwap(true)">
                <img id="jobsFeaturedIcon" alt="Jobs" class="h-7 w-7 select-none pointer-events-none">
              </button>
              <h2 class="text-xl md:text-2xl font-semibold text-slate-900 dark:text-white">No jobs found</h2>
              <p class="mt-2 text-sm md:text-base text-slate-600 dark:text-slate-300">Once jobs are created, they will appear here</p>
              <div class="mt-6 flex items-center justify-center gap-3">
                <button type="button" id="openDrawerBtn" class="inline-flex h-10 items-center justify-center rounded-md border px-4 text-sm font-medium border-slate-300 bg-white text-slate-700 hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:hover:bg-slate-700">Open Context Panel</button>
                <button type="button" class="inline-flex h-10 items-center justify-center rounded-md px-4 text-sm font-semibold text-white transition-colors" style="background:#711FFF;" onmouseover="this.style.background='#6020df';" onmouseout="this.style.background='#711FFF';">+ New Job</button>
              </div>
            </div>
          </section>`;
      } else if (currentItem.path === '#/app/quick-tasks') {
        contentHtml = `
          <section class="relative mx-auto max-w-2xl">
            <div class="mx-auto w-full rounded-2xl border bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm shadow-xl border-black/10 dark:border-white/10 px-6 py-8 md:px-8 md:py-10 text-center">
              <button type="button" class="me-featured-icon mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full ring-1 ring-black/10 dark:ring-white/10 bg-white dark:bg-slate-700 shadow-inner" aria-label="Quick Tasks icon" onmouseenter="quickTasksIconSwap(true)" onmouseleave="quickTasksIconSwap(false)" onclick="quickTasksIconSwap(true)">
                <img id="quickTasksFeaturedIcon" alt="Quick Tasks" class="h-7 w-7 select-none pointer-events-none">
              </button>
              <h2 class="text-xl md:text-2xl font-semibold text-slate-900 dark:text-white">No quick tasks</h2>
              <p class="mt-2 text-sm md:text-base text-slate-600 dark:text-slate-300">Add quick tasks for things you need to get done</p>
              <div class="mt-6 flex items-center justify-center gap-3">
                <button type="button" id="openDrawerBtn" class="inline-flex h-10 items-center justify-center rounded-md border px-4 text-sm font-medium border-slate-300 bg-white text-slate-700 hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:hover:bg-slate-700">Open Context Panel</button>
                <button type="button" class="inline-flex h-10 items-center justify-center rounded-md px-4 text-sm font-semibold text-white transition-colors" style="background:#711FFF;" onmouseover="this.style.background='#6020df';" onmouseout="this.style.background='#711FFF';">+ New Quick Task</button>
              </div>
            </div>
          </section>`;
      } else if (currentItem.path === '#/app/chat') {
        contentHtml = `
          <section class="relative mx-auto max-w-2xl">
            <div class="mx-auto w-full rounded-2xl border bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm shadow-xl border-black/10 dark:border-white/10 px-6 py-8 md:px-8 md:py-10 text-center">
              <button type="button" class="me-featured-icon mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full ring-1 ring-black/10 dark:ring-white/10 bg-white dark:bg-slate-700 shadow-inner" aria-label="Chat icon" onmouseenter="chatIconSwap(true)" onmouseleave="chatIconSwap(false)" onclick="chatIconSwap(true)">
                <img id="chatFeaturedIcon" alt="Chat" class="h-7 w-7 select-none pointer-events-none">
              </button>
              <h2 class="text-xl md:text-2xl font-semibold text-slate-900 dark:text-white">No conversations yet</h2>
              <p class="mt-2 text-sm md:text-base text-slate-600 dark:text-slate-300">Start a new conversation with your team</p>
              <div class="mt-6 flex items-center justify-center gap-3">
                <button type="button" class="inline-flex h-10 items-center justify-center rounded-md px-4 text-sm font-semibold text-white transition-colors" style="background:#711FFF;" onmouseover="this.style.background='#6020df';" onmouseout="this.style.background='#711FFF';">Start a Conversation</button>
              </div>
            </div>
          </section>`;
      } else if (currentItem.path === '#/app/performance') {
        const today = new Date();
        const oneDay = 24*60*60*1000;
        const onTimeRatio = 92; 
        const jobsAtRisk = mockReportData.jobs.filter(j => (j.actualHours / (j.estHours || 1)) * 100 > 85).length;
        const next14Days = new Date(today.getTime() + 14 * oneDay);
        let hoursDue = 0;
        mockReportData.deliverables.forEach(d => { const dDate = new Date(d.due); if (!isNaN(dDate) && dDate >= today && dDate <= next14Days) hoursDue += 42; });
        if (hoursDue === 0) hoursDue = 126;
        const teamCapacity = 120; 
        const capacityRatio = (hoursDue / teamCapacity) * 100;
        const capacityStatus = capacityRatio > 100 ? 'Overbooked' : (capacityRatio > 85 ? 'Tight' : 'OK');
        const capColor = getStoplightClasses(capacityRatio);
        let overdueCount = 0;
        let due7Count = 0;
        const next7Days = new Date(today.getTime() + 7 * oneDay);
        mockReportData.deliverables.forEach(d => { const dDate = new Date(d.due); if (isNaN(dDate)) return; const dTime = dDate.setHours(0,0,0,0); const nowTime = today.setHours(0,0,0,0); if (dTime < nowTime) overdueCount++; else if (dTime <= next7Days.getTime()) due7Count++; });
        let tableData = mockReportData.deliverables;
        if (REPORT_FILTER === 'overdue') tableData = tableData.filter(d => { const dt = new Date(d.due); return !isNaN(dt) && dt < today; });
        else if (REPORT_FILTER === 'due7') tableData = tableData.filter(d => { const dt = new Date(d.due); return !isNaN(dt) && dt >= today && dt <= next7Days; });
        const sortedJobs = mockReportData.jobs.map(j => { const timelinePct = getTimelinePercent(j.startDate, j.plannedEnd); const effortPct = (j.actualHours / (j.estHours || 1)) * 100; const maxRisk = Math.max(timelinePct, effortPct); return { ...j, timelinePct, effortPct, maxRisk }; }).sort((a, b) => b.maxRisk - a.maxRisk);
        const sortedDeliverables = tableData.map(d => { const est = d.estHours || 20; const safeEffort = d.effortConsumed || 0; const actual = (safeEffort / 100) * est; const timelinePct = d.durationConsumed || 0; const maxRisk = Math.max(timelinePct, safeEffort); return { ...d, est, actual, timelinePct, maxRisk }; }).sort((a, b) => b.maxRisk - a.maxRisk);
        const csvContent = "ID,Name,Job,Owner,Due,Effort,Timeline\n" + sortedDeliverables.map(d => `${d.id},"${d.name}","${d.jobName}","${d.owner}",${d.due},${d.effortConsumed},${d.timelinePct}`).join("\n");
        const encodedUri = "data:text/csv;charset=utf-8," + encodeURIComponent(csvContent);

        contentHtml = `
          <div class="w-full max-w-7xl mx-auto">
            <header class="mb-8">
              <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Performance Dashboard</h1>
              <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">Real-time overview of effort, duration, and team capacity.</p>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
              <div class="bg-white dark:bg-gray-800/50 rounded-xl shadow border border-black/10 dark:border-white/10 p-5 flex flex-col justify-between">
                 <div> <h2 class="text-sm font-medium text-gray-500 dark:text-gray-400">On-Time Effort Ratio</h2> <div class="mt-2 flex items-baseline gap-2"> <span class="text-3xl font-bold text-gray-900 dark:text-white">${onTimeRatio}%</span> <span class="text-xs font-medium text-green-600 dark:text-green-400">Target 85%</span> </div> </div> <div class="mt-4 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5"> <div class="bg-green-500 h-1.5 rounded-full" style="width: ${onTimeRatio}%"></div> </div>
              </div>
              <div class="bg-white dark:bg-gray-800/50 rounded-xl shadow border border-black/10 dark:border-white/10 p-5 flex flex-col justify-between">
                 <h2 class="text-sm font-medium text-gray-500 dark:text-gray-400">Jobs at Risk</h2> <div class="mt-2"> <span class="text-3xl font-bold ${jobsAtRisk > 0 ? 'text-yellow-600 dark:text-yellow-400' : 'text-gray-900 dark:text-white'}">${jobsAtRisk}</span> <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Active jobs with Effort or Timeline > 85%</p> </div>
              </div>
              <div class="bg-white dark:bg-gray-800/50 rounded-xl shadow border border-black/10 dark:border-white/10 p-5 flex flex-col justify-between" data-tooltip="Compare total hours due in next 14 days to team’s weekly capacity.">
                 <h2 class="text-sm font-medium text-gray-500 dark:text-gray-400">Capacity Next 14 Days</h2> <div class="mt-2"> <span class="text-3xl font-bold ${capColor.text}">${capacityStatus}</span> <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Hours due in 14 days: ${hoursDue}h</p> </div>
              </div>
              <div class="bg-white dark:bg-gray-800/50 rounded-xl shadow border border-black/10 dark:border-white/10 p-5 flex flex-col justify-between" data-tooltip="Deliverables past due or due within 7 days.">
                 <h2 class="text-sm font-medium text-gray-500 dark:text-gray-400">Overdue & Due Soon</h2> <div class="mt-3 flex flex-wrap gap-2"> <button class="filter-chip px-3 py-1 rounded-full text-xs font-medium border border-red-200 bg-red-50 text-red-700 dark:border-red-900/30 dark:bg-red-900/20 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/40 ${REPORT_FILTER === 'overdue' ? 'active ring-2 ring-red-500' : ''}" data-filter="overdue"> Overdue (${overdueCount}) </button> <button class="filter-chip px-3 py-1 rounded-full text-xs font-medium border border-yellow-200 bg-yellow-50 text-yellow-700 dark:border-yellow-900/30 dark:bg-yellow-900/20 dark:text-yellow-400 hover:bg-yellow-100 dark:hover:bg-yellow-900/40 ${REPORT_FILTER === 'due7' ? 'active ring-2 ring-yellow-500' : ''}" data-filter="due7"> Due in 7 Days (${due7Count}) </button> ${REPORT_FILTER !== 'all' ? `<button class="text-xs underline text-gray-500" data-filter="all">Clear</button>` : ''} </div>
              </div>
            </div>
            <div class="space-y-8">
              <div>
                <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Portfolio Status</h2>
                <div class="bg-white dark:bg-gray-800/50 rounded-lg shadow border border-black/10 dark:border-white/10 overflow-hidden">
                  <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                      <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"> <tr> <th scope="col" class="px-6 py-3">Job Name</th> <th scope="col" class="px-6 py-3">Client</th> <th scope="col" class="px-6 py-3">Performance (LOE & Timeline)</th> </tr> </thead>
                      <tbody>
                        ${sortedJobs.map(job => `<tr class="bg-white dark:bg-gray-800 border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"> <td class="px-6 py-4 font-medium text-gray-900 dark:text-white whitespace-nowrap">${job.name}</td> <td class="px-6 py-4">${job.client}</td> <td class="px-6 py-4"> ${renderStackedPerformance(job.actualHours, job.estHours, job.timelinePct)} </td> </tr>`).join('')}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <div>
                <div class="flex items-center justify-between mb-4"> <h2 class="text-xl font-semibold text-gray-900 dark:text-white">At-Risk Deliverables <span class="text-sm font-normal text-gray-500 ml-2">(${sortedDeliverables.length})</span></h2> <a href="${encodedUri}" download="at_risk_deliverables.csv" class="inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 text-xs font-medium rounded text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700"> Export List → CSV </a> </div>
                <div class="bg-white dark:bg-gray-800/50 rounded-lg shadow border border-black/10 dark:border-white/10 overflow-hidden">
                  <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                      <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"> <tr> <th scope="col" class="px-6 py-3">Job / Deliverable</th> <th scope="col" class="px-6 py-3">Performance (LOE & Timeline)</th> <th scope="col" class="px-6 py-3">Owner</th> <th scope="col" class="px-6 py-3">Due</th> <th scope="col" class="px-6 py-3 text-right">Suggested Action</th> </tr> </thead>
                      <tbody>
                      ${sortedDeliverables.length === 0 ? `<tr><td colspan="5" class="px-6 py-8 text-center text-gray-500">No deliverables match current filter.</td></tr>` : 
                        sortedDeliverables.map(d => `<tr class="bg-white dark:bg-gray-800 border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"> <td class="px-6 py-4"> <div class="font-medium text-gray-900 dark:text-white">${d.name}</div> <div class="text-xs text-gray-500 dark:text-gray-400">${d.jobName}</div> </td> <td class="px-6 py-4"> ${renderStackedPerformance(d.actual, d.est, d.timelinePct)} </td> <td class="px-6 py-4">${d.owner}</td> <td class="px-6 py-4 whitespace-nowrap ${new Date(d.due) < today ? 'text-red-600 font-medium' : ''}">${d.due}</td> <td class="px-6 py-4 text-right whitespace-nowrap"> <div class="flex justify-end gap-2"> <button class="text-xs text-netnet-purple dark:text-white hover:underline" onclick="openActionModal('reassign', ${d.id})">Reassign</button> <span class="text-gray-300">|</span> <button class="text-xs text-netnet-purple dark:text-white hover:underline" onclick="openActionModal('rescope', ${d.id})">Re-scope</button> <span class="text-gray-300">|</span> <button class="text-xs text-netnet-purple dark:text-white hover:underline" onclick="openActionModal('movedate', ${d.id})">Move Date</button> </div> </td> </tr>`).join('')}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>`;
      } else if (currentItem.path === '#/app/net-net-u') {
        contentHtml = `
          <section class="relative mx-auto max-w-2xl">
            <div class="mx-auto w-full rounded-2xl border bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm shadow-xl border-black/10 dark:border-white/10 px-6 py-8 md:px-8 md:py-10 text-center">
              <button type="button" class="me-featured-icon mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full ring-1 ring-black/10 dark:ring-white/10 bg-white dark:bg-slate-700 shadow-inner" aria-label="Net Net U icon" onmouseenter="nnuIconSwap(true)" onmouseleave="nnuIconSwap(false)" onclick="nnuIconSwap(true)">
                <img id="nnuFeaturedIcon" alt="Net Net U" class="h-7 w-7 select-none pointer-events-none">
              </button>
              <h2 class="text-xl md:text-2xl font-semibold text-slate-900 dark:text-white">Welcome to Net Net University</h2>
              <p class="mt-2 text-sm md:text-base text-slate-600 dark:text-slate-300">Learning content and tutorials will be available here soon.</p>
              <div class="mt-6"><button type="button" class="inline-flex h-10 items-center justify-center rounded-md px-4 text-sm font-semibold text-white transition-colors" style="background:#711FFF;" onmouseover="this.style.background='#6020df';" onmouseout="this.style.background='#711FFF';">Explore Content</button></div>
            </div>
          </section>`;
      } else {
        contentHtml = `<div class="text-center"><h1 class="text-2xl font-bold text-gray-900 dark:text-white">${currentItem.name || "Page Not Found"}</h1><p class="mt-2 text-gray-600 dark:text-gray-400">This page is under construction.</p></div>`;
      }
      
      const mainWrapperClass = (currentItem.path === '#/app/performance' || currentItem.path === '#/app/contacts' || currentItem.path === '#/app/net-net-bot' || companyMatch || personMatch)
        ? (currentItem.path === '#/app/contacts' || currentItem.path === '#/app/net-net-bot' || companyMatch || personMatch ? 'h-full overflow-hidden bg-white dark:bg-gray-900' : 'p-4 sm:p-6 lg:p-8')
        : 'p-4 sm:p-6 lg:p-8 flex items-center justify-center';

      return `<main id="app-main" class="${mainWrapperClass}">${contentHtml}</main>`;
    }

    let profileState = { isEditing: false, isIntl: false };
    
    function wireProfileEvents(type, id) {
        const container = document.getElementById('profile-container');
        if (!container) return;
        
        let data = null;
        if (type === 'company') {
            data = mockContactsData.find(c => c.id === id);
        } else {
            mockContactsData.forEach(c => {
               const p = c.people.find(person => person.id === id);
               if (p) data = { ...p, companyName: c.name, companyId: c.id };
            });
        }
        
        if (!data) {
            container.innerHTML = `<div class="p-8 text-center text-gray-500">Item not found.</div>`;
            return;
        }

        const render = () => {
            const { isEditing, isIntl } = profileState;
            const labelClass = "block text-xs font-semibold uppercase text-gray-500 dark:text-gray-400 mb-1";
            const inputClass = "w-full h-10 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white px-3 focus:ring-2 focus:ring-netnet-purple focus:outline-none";
            const viewValueClass = "text-gray-900 dark:text-white text-base font-medium min-h-[1.5rem]";
            
            const toggleHtml = `
                <label class="inline-flex items-center cursor-pointer">
                  <input type="checkbox" class="sr-only peer" id="fmt-toggle" ${isIntl ? 'checked' : ''}>
                  <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-netnet-purple dark:peer-focus:ring-white rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-netnet-purple"></div>
                  <span class="ms-2 text-xs font-medium text-gray-500 dark:text-gray-400">International</span>
                </label>
            `;
            
            const buttonsHtml = isEditing 
                ? `<button id="save-btn" class="px-3 py-1.5 bg-netnet-purple text-white rounded text-sm hover:bg-[#6020df]">Save</button>
                   <button id="cancel-btn" class="px-3 py-1.5 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded text-sm hover:bg-gray-50 dark:hover:bg-gray-700">Cancel</button>`
                : `<button id="edit-btn" class="px-3 py-1.5 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded text-sm hover:bg-gray-50 dark:hover:bg-gray-700">Edit</button>`;

            const zipLabel = isIntl ? "Postal Code" : "Zip Code";
            const stateLabel = isIntl ? "Province" : "State";
            const phoneLabel = isIntl ? "Phone (+Intl)" : "Phone (USA)";
            
            // ACTIVITY FEED RENDERER
            const renderActivityFeed = () => {
                const activities = data.activities || [];
                // Sort by date desc
                const sorted = [...activities].sort((a,b) => new Date(b.date) - new Date(a.date));
                // Add simulated jobs
                const jobItems = (type === 'company') ? mockReportData.jobs.map(j => ({ type: 'job', ...j })) : []; // Simplified association
                const allItems = [...sorted, ...jobItems].sort((a,b) => {
                     const dA = a.date || a.startDate;
                     const dB = b.date || b.startDate;
                     return new Date(dB) - new Date(dA);
                });
                
                return `
                   <div class="flex flex-col h-full bg-gray-50 dark:bg-gray-900 border-l border-gray-200 dark:border-gray-700">
                      <div class="p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
                         <h3 class="text-sm font-semibold text-gray-900 dark:text-white uppercase mb-3">Activity Feed</h3>
                         <div class="relative">
                            <textarea id="quick-note" rows="2" class="w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-sm p-3 pr-10 focus:ring-1 focus:ring-netnet-purple focus:outline-none resize-none" placeholder="Add a note..."></textarea>
                            <button class="absolute right-2 bottom-2 text-gray-400 hover:text-netnet-purple" onclick="showToast('Voice note started...')">
                               ${CHAT_UI_ICONS.mic}
                            </button>
                         </div>
                         <div class="mt-2 flex justify-end">
                            <button id="add-note-btn" class="px-3 py-1 bg-netnet-purple text-white text-xs font-medium rounded hover:bg-[#6020df]">Add Note</button>
                         </div>
                      </div>
                      <div class="flex-1 overflow-y-auto p-4 space-y-4">
                         ${allItems.length === 0 ? '<div class="text-center text-sm text-gray-500 mt-4">No activity yet.</div>' : ''}
                         ${allItems.map(item => {
                             let icon = ''; 
                             let content = '';
                             let dateStr = item.date || item.startDate;
                             
                             if (item.type === 'note') {
                                 icon = `<div class="w-8 h-8 rounded-full bg-yellow-100 dark:bg-yellow-900/30 flex items-center justify-center text-yellow-600 dark:text-yellow-400"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></div>`;
                                 content = `<div class="text-sm text-gray-800 dark:text-gray-200">${item.text}</div><div class="text-xs text-gray-400 mt-1">Note by ${item.user}</div>`;
                             } else if (item.type === 'email') {
                                 icon = `<div class="w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div>`;
                                 content = `<div class="font-medium text-sm text-gray-900 dark:text-white">${item.subject}</div><div class="text-sm text-gray-500 dark:text-gray-400 truncate">${item.snippet}</div>`;
                             } else if (item.type === 'meeting') {
                                 icon = `<div class="w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-600 dark:text-purple-400"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="1<script type="module" src="/index.tsx"></script>
